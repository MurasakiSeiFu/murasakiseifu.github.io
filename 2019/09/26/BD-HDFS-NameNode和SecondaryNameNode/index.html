<!DOCTYPE html>


  <html class="dark page-post">


<head>
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  
  <title>MurasakiSeiFu</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="java,redis,nginx,zookeeper,åˆ†å¸ƒå¼ä¸­é—´ä»¶,å¾®æœåŠ¡,springboot,mysql" />
  

  <meta name="description" content="title: BD-HDFS-NameNodeå’ŒSecondaryNameNodeauthor: MurasakiSeiFu.date: 2019-09-26 09:27:36tags:categories:  Hadoop-HDFS  BD-HDFS-NameNodeå’ŒSecondaryNameNodeä¸»è¦å†…å®¹ NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶ Fsimageå’ŒEditsè§£æ CheckPointæ—¶é—´è®¾ç½®">
<meta property="og:type" content="article">
<meta property="og:title" content="MurasakiSeiFu">
<meta property="og:url" content="http://ilovenorth.life/2019/09/26/BD-HDFS-NameNodeå’ŒSecondaryNameNode/index.html">
<meta property="og:site_name" content="MurasakiSeiFu">
<meta property="og:description" content="title: BD-HDFS-NameNodeå’ŒSecondaryNameNodeauthor: MurasakiSeiFu.date: 2019-09-26 09:27:36tags:categories:  Hadoop-HDFS  BD-HDFS-NameNodeå’ŒSecondaryNameNodeä¸»è¦å†…å®¹ NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶ Fsimageå’ŒEditsè§£æ CheckPointæ—¶é—´è®¾ç½®">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7br5bnf2dj313a0u0wj5.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7br92hd3rj312y0u079u.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7breiswt0j310i0u00z4.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7brosqqh2j31ms0u0gu8.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7brvs9k5cj31ms0u0k1a.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bs6nieb2j31mq0u0dqw.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bscdx88kj31n00u0am2.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bshj5vs1j31mx0u07h0.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bsre61a8j31me0u0nbq.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4exas9xj31rk0u0gw4.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4kkqzb3j310w0ds40z.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4mbq6dhj317c06mmz0.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4oogh79j315g0nyk5r.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c54dmyslj311a09ejvs.jpg">
<meta property="og:updated_time" content="2019-09-26T12:44:47.164Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MurasakiSeiFu">
<meta name="twitter:description" content="title: BD-HDFS-NameNodeå’ŒSecondaryNameNodeauthor: MurasakiSeiFu.date: 2019-09-26 09:27:36tags:categories:  Hadoop-HDFS  BD-HDFS-NameNodeå’ŒSecondaryNameNodeä¸»è¦å†…å®¹ NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶ Fsimageå’ŒEditsè§£æ CheckPointæ—¶é—´è®¾ç½®">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7br5bnf2dj313a0u0wj5.jpg">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86660611-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?2e6da3c375c8a87f5b664cea6d4cb29c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">ğŸ†</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">ğŸ†</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            å‹é“¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            æœç´¢
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts List</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BD-HDFS-NameNodeå’ŒSecondaryNameNode"><span class="toc-text">BD-HDFS-NameNodeå’ŒSecondaryNameNode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸»è¦å†…å®¹"><span class="toc-text">ä¸»è¦å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶"><span class="toc-text">1.1 NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬ä¸€æ­¥"><span class="toc-text">ç¬¬ä¸€æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬äºŒæ­¥"><span class="toc-text">ç¬¬äºŒæ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬ä¸‰æ­¥"><span class="toc-text">ç¬¬ä¸‰æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬å››æ­¥"><span class="toc-text">ç¬¬å››æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬äº”æ­¥"><span class="toc-text">ç¬¬äº”æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬å…­æ­¥"><span class="toc-text">ç¬¬å…­æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬ä¸ƒæ­¥"><span class="toc-text">ç¬¬ä¸ƒæ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬å…«æ­¥"><span class="toc-text">ç¬¬å…«æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¬¬ä¹æ­¥"><span class="toc-text">ç¬¬ä¹æ­¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Fsimageå’ŒEditsè§£æ"><span class="toc-text">2 Fsimageå’ŒEditsè§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Fsimageå’ŒEditsæ¦‚å¿µ"><span class="toc-text">2.1 Fsimageå’ŒEditsæ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-oivæŸ¥çœ‹Fsimageæ–‡ä»¶"><span class="toc-text">2.2 oivæŸ¥çœ‹Fsimageæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-oevæŸ¥çœ‹Editsæ–‡ä»¶"><span class="toc-text">2.3 oevæŸ¥çœ‹Editsæ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-CheckPointæ—¶é—´è®¾ç½®"><span class="toc-text">3 CheckPointæ—¶é—´è®¾ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-NameNodeæ•…éšœå¤„ç†"><span class="toc-text">4 NameNodeæ•…éšœå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-å°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•"><span class="toc-text">4.1 å°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-ä½¿ç”¨-importCheckpointé€‰é¡¹å¯åŠ¨NameNodeå®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeç›®å½•ä¸­ã€‚"><span class="toc-text">4.2 ä½¿ç”¨-importCheckpointé€‰é¡¹å¯åŠ¨NameNodeå®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeç›®å½•ä¸­ã€‚</span></a></li></ol></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-BD-HDFS-NameNodeå’ŒSecondaryNameNode" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">(no title)</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2019.09.26</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>MurasakiSeiFu.</span>
        </span>
      

      


      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>title: BD-HDFS-NameNodeå’ŒSecondaryNameNode<br>author: MurasakiSeiFu.<br>date: 2019-09-26 09:27:36<br>tags:<br>categories:</p>
<ul>
<li>Hadoop-HDFS</li>
</ul>
<h1 id="BD-HDFS-NameNodeå’ŒSecondaryNameNode"><a href="#BD-HDFS-NameNodeå’ŒSecondaryNameNode" class="headerlink" title="BD-HDFS-NameNodeå’ŒSecondaryNameNode"></a>BD-HDFS-NameNodeå’ŒSecondaryNameNode</h1><h2 id="ä¸»è¦å†…å®¹"><a href="#ä¸»è¦å†…å®¹" class="headerlink" title="ä¸»è¦å†…å®¹"></a>ä¸»è¦å†…å®¹</h2><ol>
<li>NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶</li>
<li>Fsimageå’ŒEditsè§£æ</li>
<li>CheckPointæ—¶é—´è®¾ç½®</li>
<li>NameNode æ•…éšœå¤„ç†</li>
</ol>
<h2 id="1-1-NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶"><a href="#1-1-NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶" class="headerlink" title="1.1 NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶"></a>1.1 NNå’Œ2NNçš„å·¥ä½œæœºåˆ¶</h2><p>é—®é¢˜ï¼šå…ƒæ•°æ®å°±æ˜¯æè¿°æ•°æ®çš„æ•°æ®ï¼ŒNameNodeä¸­çš„å…ƒæ•°æ®ç›¸å½“äºä¸€æœ¬ä¹¦çš„ç›®å½•ï¼Œå¯ä»¥æ‰¾åˆ°DataNodeä¸­çš„å—ã€‚é‚£ä¹ˆNameNodeä¸­çš„å…ƒæ•°æ®æ˜¯å­˜å‚¨åœ¨å“ªé‡Œçš„ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åšä¸ªå‡è®¾ï¼Œå¦‚æœå…ƒæ•°æ®å­˜å‚¨åœ¨NameNodeèŠ‚ç‚¹çš„ç£ç›˜ä¸­ï¼Œå› ä¸ºç»å¸¸éœ€è¦è¿›è¡Œéšæœºè®¿é—®ï¼Œè¿˜æœ‰å“åº”å®¢æˆ·è¯·æ±‚ï¼Œå¿…ç„¶æ˜¯æ•ˆç‡è¿‡ä½ã€‚å› æ­¤ï¼Œå…ƒæ•°æ®éœ€è¦å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚ä½†å¦‚æœåªå­˜åœ¨å†…å­˜ä¸­ï¼Œä¸€æ—¦æ–­ç”µï¼Œå…ƒæ•°æ®ä¸¢å¤±ï¼Œæ•´ä¸ªé›†ç¾¤å°±æ— æ³•å·¥ä½œäº†ã€‚<font color="red">å› æ­¤äº§ç”Ÿäº†åœ¨ç£ç›˜ä¸­å¤‡ä»½å…ƒæ•°æ®çš„FsImageã€‚</font></p>
<p>è¿™æ ·åˆä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼Œå½“åœ¨å†…å­˜ä¸­çš„å…ƒæ•°æ®æ›´æ–°æ—¶ï¼Œå¦‚æœåŒæ—¶æ›´æ–°FsImageï¼Œå°±ä¼šå¯¼è‡´æ•ˆç‡è¿‡ä½ï¼Œä½†å¦‚æœä¸æ›´æ–°ï¼Œå°±ä¼šå‘ç”Ÿä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€æ—¦NameNodeèŠ‚ç‚¹æ–­ç”µï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ã€‚<font color="red">å› æ­¤ï¼Œå¼•å…¥Editsæ–‡ä»¶(åªè¿›è¡Œè¿½åŠ æ“ä½œï¼Œæ•ˆç‡å¾ˆé«˜)ã€‚æ¯å½“å…ƒæ•°æ®æœ‰æ›´æ–°æˆ–è€…æ·»åŠ å…ƒæ•°æ®æ—¶ï¼Œä¿®æ”¹å†…å­˜ä¸­çš„å…ƒæ•°æ®å¹¶è¿½åŠ åˆ°Editsä¸­ã€‚</font>è¿™æ ·ï¼Œä¸€æ—¦NameNodeèŠ‚ç‚¹æ–­ç”µï¼Œå¯ä»¥é€šè¿‡FsImageå’ŒEditsçš„åˆå¹¶ï¼Œåˆæˆå…ƒæ•°æ®ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœé•¿æ—¶é—´æ·»åŠ æ•°æ®åˆ°Editsä¸­ï¼Œä¼šå¯¼è‡´è¯¥æ–‡ä»¶æ•°æ®è¿‡å¤§ï¼Œæ•ˆç‡é™ä½ï¼Œè€Œä¸”ä¸€æ—¦æ–­ç”µï¼Œæ¢å¤å…ƒæ•°æ®éœ€è¦çš„æ—¶é—´è¿‡é•¿ã€‚å› æ­¤ï¼Œéœ€è¦å®šæœŸè¿›è¡ŒFsImageå’ŒEditsçš„åˆå¹¶ï¼Œå¦‚æœè¿™ä¸ªæ“ä½œç”±NameNodeèŠ‚ç‚¹å®Œæˆï¼Œåˆä¼šæ•ˆç‡è¿‡ä½ã€‚<font color="red">å› æ­¤ï¼Œå¼•å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹SecondaryNamenodeï¼Œä¸“é—¨ç”¨äºFsImageå’ŒEditsçš„åˆå¹¶ã€‚</font></p>
<p>è¿™ä¹ˆçœ‹ç¡®å®å¾ˆéš¾ç†è§£ï¼Œæˆ‘ä»¬ç»“åˆNNå’Œ2NNçš„å·¥ä½œæœºåˆ¶ï¼Œå°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7br5bnf2dj313a0u0wj5.jpg" alt=""></p>
<p>å½“æˆ‘ä»¬é›†ç¾¤é¦–æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼ŒNNä¼šåŠ è½½FsImageï¼Œå› ä¸ºFsImageåŠ è½½èµ·æ¥æ¯”è¾ƒå¿«ï¼ˆç›¸å½“äºRedisçš„RDBå¿«ç…§ï¼‰ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡edits_inprogress_001ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7br92hd3rj312y0u079u.jpg" alt=""></p>
<p>åŠ è½½å®Œäº†ä»¥åå°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚è¿™æ—¶ï¼Œæ¥äº†ä¸€æ¡å…ƒæ•°æ®çš„å¢åˆ æ”¹è¯·æ±‚ã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7breiswt0j310i0u00z4.jpg" alt=""></p>
<p>æ­¤æ—¶é¢ä¸´ä¸€ä¸ªé€‰æ‹©ï¼šæˆ‘ä»¬æ˜¯å…ˆæ›´æ–°å†…å­˜å†æ›´æ–°æ–‡ä»¶ï¼Ÿè¿˜æ˜¯å…ˆæ›´æ–°æ–‡ä»¶å†æ›´æ–°å†…å­˜ï¼Ÿå› ä¸ºHDFSå¯¹æ•°æ®å®‰å…¨æ€§è¾ƒé«˜ï¼Œæ‰€ä»¥ä¼šé€‰æ‹©å…ˆæ›´æ–°æ–‡ä»¶å†æ›´æ–°å†…å­˜ï¼Œå½“æ–‡ä»¶æ›´æ–°å®Œäº†å°±ä¼šé€šçŸ¥å®¢æˆ·ç«¯ï¼Œå¦‚æœæ­¤æ—¶æ–­ç‚¹ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ›´æ–°çš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå°†æ›´æ–°çš„æ“ä½œæ—¥å¿—è®°å½•åœ¨edits_inprogress_001ä¸­ï¼ˆ3â€”&gt;4ï¼‰</p>
<h3 id="ç¬¬å››æ­¥"><a href="#ç¬¬å››æ­¥" class="headerlink" title="ç¬¬å››æ­¥"></a>ç¬¬å››æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7brosqqh2j31ms0u0gu8.jpg" alt=""></p>
<p>éšç€edits_inprogress_001è®°å½•çš„æ“ä½œè¶Šæ¥è¶Šå¤šï¼Œä½¿å¾—è¿™ä¸ªæ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦åˆå¹¶åˆ°ï¼Œè¿™æ—¶å€™2NNå°±ç™»åœºäº†ã€‚é¦–å…ˆï¼Œ2NNæ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šé—®NNä¸€æ¬¡ï¼Œéœ€ä¸éœ€è¦åˆå¹¶ï¼Œæ³¨æ„å¹¶ä¸æ˜¯è¿™ä¸ªé—´éš”æ—¶é—´åˆ°äº†ä¹‹åä¸€å®šè¦åˆå¹¶ï¼Œè€Œæ˜¯è¿›è¡Œè¯¢é—®æ˜¯å¦éœ€è¦åˆå¹¶ã€‚</p>
<h3 id="ç¬¬äº”æ­¥"><a href="#ç¬¬äº”æ­¥" class="headerlink" title="ç¬¬äº”æ­¥"></a>ç¬¬äº”æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7brvs9k5cj31ms0u0k1a.jpg" alt=""></p>
<p>NNæ˜¯å¦ä¼šåŒæ„è¿›è¡Œåˆå¹¶ï¼Œæœ‰ä¸¤ç§å‡ºå‘æ¡ä»¶ï¼šç¬¬ä¸€ç§ï¼Œè·ç¦»ä¸Šä¸€æ¬¡åˆå¹¶ï¼Œå·²ç»åˆ°è¾¾ä¸€å®šçš„æ—¶é—´äº†ï¼Œç¬¬äºŒç§ï¼ŒEditsä¸­çš„æ•°æ®æ»¡äº†ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡ï¼Œåé¢ä¼šè¯´ã€‚å¦‚æœè¿™ä¸¤ä¸ªæ¡ä»¶è§¦å‘äº†å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œéƒ½ä¼šå‘ç”Ÿåˆå¹¶ï¼Œå¦‚æœNNå›ç­”Yesï¼Œé‚£ä¹ˆ2NNå°†å‘èµ·è¯·æ±‚åˆå¹¶</p>
<p>å¤§å®¶è¿˜è®°å¾—å½“æ—¶NameNodeæ˜¯æ€ä¹ˆåŠ è½½æ•°æ®çš„ï¼Ÿå…ˆåŠ è½½äº†ä¸€ä¸ªFsImageï¼Œç±»ä¼¼æˆ‘ä»¬å†…å­˜çš„å­˜æ¡£æˆ–è€…ä¸€ä¸ªè¿›åº¦ï¼ŒåŠ è½½å®Œäº†ä¹‹åï¼Œæˆ‘ä»¬åˆå¾€NameNodeçš„å†…å­˜å†™äº†å¾ˆå¤šæ•°æ®ï¼Œå†™çš„æ•°æ®åˆè®°å½•åœ¨edits_inprogress_001ï¼ˆedits.logï¼‰ä¸­ï¼Œç°åœ¨æˆ‘ä»¬è¦è¿›è¡Œåˆå¹¶ï¼Œåˆ°åº•è¦æŠŠé‚£éƒ¨åˆ†å‘é€ç»™2NNå‘¢ï¼Ÿedits.log + FsImageï¼Œå› ä¸ºæˆ‘ä»¬è¦å®Œå…¨è¿˜åŸæˆ‘ä»¬çš„å†…å­˜é•œåƒï¼Œå°±æ˜¯FsImageï¼ˆå­˜æ¡£ï¼‰+ edits.logï¼ˆå­˜æ¡£ä¹‹åçš„å˜åŠ¨æ“ä½œï¼‰ã€‚å…·ä½“NNçš„åšæ³•å¦‚ä¸‹å›¾ï¼š</p>
<h3 id="ç¬¬å…­æ­¥"><a href="#ç¬¬å…­æ­¥" class="headerlink" title="ç¬¬å…­æ­¥"></a>ç¬¬å…­æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bs6nieb2j31mq0u0dqw.jpg" alt=""></p>
<p>é¦–å…ˆï¼ŒNNæŠŠæˆ‘ä»¬æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶edits_inprgress_001æ”¹ä¸ªåå­—ä¸ºedits_001ï¼Œç„¶åæ–°å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå–åä¸ºedits_inprogress_002ï¼Œæ–°çš„æ–‡ä»¶ç”¨æ¥å†™æ–°çš„æ“ä½œè®°å½•ï¼Œä¸ºäº†ä¸è®©æŒä¹…åŒ–æ“ä½œå½±å“æ–°çš„æ•°æ®æ›´æ–°ã€‚</p>
<h3 id="ç¬¬ä¸ƒæ­¥"><a href="#ç¬¬ä¸ƒæ­¥" class="headerlink" title="ç¬¬ä¸ƒæ­¥"></a>ç¬¬ä¸ƒæ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bscdx88kj31n00u0am2.jpg" alt=""></p>
<p>ç„¶åNNå°†edits_001å’Œfsimageæ‹·è´åˆ°2NNï¼ˆfsimage + fsimageä¹‹åå‘ç”Ÿçš„æ“ä½œï¼‰ã€‚</p>
<h3 id="ç¬¬å…«æ­¥"><a href="#ç¬¬å…«æ­¥" class="headerlink" title="ç¬¬å…«æ­¥"></a>ç¬¬å…«æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bshj5vs1j31mx0u07h0.jpg" alt=""></p>
<p>æ¥ä¸‹æ¥2NNå¼€å§‹è¿›è¡Œåˆå¹¶ï¼Œå…¶å®2NNåˆå¹¶çš„è¿‡ç¨‹å’ŒNNå¯åŠ¨çš„è¿‡ç¨‹éå¸¸åƒï¼Œç¬¬ä¸€æ­¥ï¼Œå…ˆåŠ è½½fsimageï¼Œè¿™ä¸ªç›¸å½“äºNNçš„å­˜æ¡£ï¼Œç¬¬äºŒæ­¥ï¼ŒåŠ è½½å®Œäº†ä¹‹åå†åŠ è½½edits_001ä¸­çš„æ“ä½œã€‚æ­¤æ—¶2NNçš„å†…å­˜çŠ¶æ€ä¸ºï¼Œedits_001è¿™äº›æ•°æ®æˆªæ­¢çš„æ—¶å€™ï¼ˆæˆ‘ä»¬ç¨åå†è¯´ï¼‰ã€‚</p>
<h3 id="ç¬¬ä¹æ­¥"><a href="#ç¬¬ä¹æ­¥" class="headerlink" title="ç¬¬ä¹æ­¥"></a>ç¬¬ä¹æ­¥</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7bsre61a8j31me0u0nbq.jpg" alt=""></p>
<p>2NNåˆå¹¶å®Œæˆåç”Ÿæˆæ–°çš„fsimage.chkpointï¼Œå¹¶æ‹·è´åˆ°NNã€‚NameNodeå°†fsimage.chkpointé‡æ–°å‘½åæˆfsimageã€‚è¿™æ ·ï¼Œä¸€æ¬¡æŒä¹…åŒ–çš„æ“ä½œå°±å®Œæˆäº†ã€‚</p>
<p>Fsimageå°±ç›¸å½“äºå†…å­˜çš„å­˜æ¡£ï¼Œè®°å½•äº†å†…å­˜çš„çŠ¶æ€ï¼Œeditså°±ç›¸å½“äºå­˜æ¡£ä¹‹åå’Œä¸‹ä¸€æ¬¡å­˜æ¡£ä¹‹é—´ï¼Œè®°å½•æœªå½•å…¥å­˜æ¡£çš„æ“ä½œçš„å°çº¸æ¡ã€‚å½“æˆ‘ä»¬ä¸‹æ¬¡å¯åŠ¨å¼€å§‹è¯»æ¡£çš„æ—¶å€™ï¼Œä¼šå°†å°çº¸æ¡ä¸Šçš„æ“ä½œä¸€æ¡æ¡çš„æ‰§è¡Œä¸€éã€‚2NNå°±åƒNNçš„ç§˜ä¹¦ä¸€æ ·ï¼ŒNNå°†å¯¹äºå­˜æ¡£è¯»æ¡£çš„ç®¡ç†äº¤ç»™2NNï¼Œç”±2NNæ¥æ‰§è¡Œå°çº¸æ¡ä¸Šçš„æ“ä½œï¼Œå¹¶è®°å½•åˆ°æ–°å­˜æ¡£ä¸­ï¼Œå†å°†æ–°å­˜æ¡£äº¤ç»™NNã€‚</p>
<p><strong>ç²¾ç‚¼è¯¦è§£ï¼ˆé…åˆç€å›¾ç‰‡æµç¨‹ï¼ŒåŒæ—¶å›ç­”äº†å›¾æµç¨‹ä¸­é—ç•™çš„é—®é¢˜ï¼‰ï¼š</strong></p>
<ol>
<li><p>NameNodeå¯åŠ¨æ—¶ï¼Œå…ˆæ»šåŠ¨Editså¹¶ç”Ÿæˆä¸€ä¸ªç©ºçš„edits.inprogressï¼Œç„¶ååŠ è½½Editså’ŒFsimageåˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶NameNodeå†…å­˜å°±æŒæœ‰æœ€æ–°çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</p>
</li>
<li><p>Clientå¼€å§‹å¯¹NameNodeå‘é€å…ƒæ•°æ®çš„å¢åˆ æ”¹çš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚çš„æ“ä½œé¦–å…ˆä¼šè¢«è®°å½•åˆ°edits.inprogressä¸­ï¼ˆæŸ¥è¯¢å…ƒæ•°æ®çš„æ“ä½œä¸ä¼šè¢«è®°å½•åœ¨Editsä¸­ï¼Œå› ä¸ºæŸ¥è¯¢æ“ä½œä¸ä¼šæ›´æ”¹å…ƒæ•°æ®ä¿¡æ¯ï¼‰ï¼Œå¦‚æœæ­¤æ—¶NameNodeæŒ‚æ‰ï¼Œé‡å¯åä¼šä»Editsä¸­è¯»å–å…ƒæ•°æ®çš„ä¿¡æ¯ã€‚ç„¶åï¼ŒNameNodeä¼šåœ¨å†…å­˜ä¸­æ‰§è¡Œå…ƒæ•°æ®çš„å¢åˆ æ”¹çš„æ“ä½œã€‚</p>
</li>
<li><p>ç”±äºEditsä¸­è®°å½•çš„æ“ä½œä¼šè¶Šæ¥è¶Šå¤šï¼ŒEditsæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´NameNodeåœ¨å¯åŠ¨åŠ è½½Editsæ—¶ä¼šå¾ˆæ…¢ï¼Œæ‰€ä»¥éœ€è¦å¯¹Editså’ŒFsimageè¿›è¡Œåˆå¹¶ï¼ˆæ‰€è°“åˆå¹¶ï¼Œå°±æ˜¯å°†Editså’ŒFsimageåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç…§ç€Editsä¸­çš„æ“ä½œä¸€æ­¥æ­¥æ‰§è¡Œï¼Œæœ€ç»ˆå½¢æˆæ–°çš„Fsimageï¼‰ã€‚SecondaryNameNodeçš„ä½œç”¨å°±æ˜¯å¸®åŠ©NameNodeè¿›è¡ŒEditså’ŒFsimageçš„åˆå¹¶å·¥ä½œã€‚</p>
</li>
<li><p>SecondaryNameNodeé¦–å…ˆä¼šè¯¢é—®NameNodeæ˜¯å¦éœ€è¦CheckPointï¼ˆè§¦å‘CheckPointéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œå®šæ—¶æ—¶é—´åˆ°å’ŒEditsä¸­æ•°æ®å†™æ»¡äº†ï¼‰ã€‚ç›´æ¥å¸¦å›NameNodeæ˜¯å¦æ£€æŸ¥ç»“æœã€‚</p>
</li>
<li><p>SecondaryNameNodeæ‰§è¡ŒCheckPointæ“ä½œï¼Œé¦–å…ˆä¼šè®©NameNodeæ»šåŠ¨Editså¹¶ç”Ÿæˆä¸€ä¸ªç©ºçš„edits.inprogressï¼Œæ»šåŠ¨Editsçš„ç›®çš„æ˜¯ç»™Editsæ‰“ä¸ªæ ‡è®°ï¼Œä»¥åæ‰€æœ‰æ–°çš„æ“ä½œéƒ½å†™å…¥edits.inprogressã€‚</p>
</li>
<li><p>å…¶ä»–æœªåˆå¹¶çš„Editså’ŒFsimageä¼šæ‹·è´åˆ°SecondaryNameNodeçš„æœ¬åœ°ï¼Œç„¶åå°†æ‹·è´çš„Editså’ŒFsimageåŠ è½½åˆ°å†…å­˜ä¸­è¿›è¡Œåˆå¹¶ï¼Œç”Ÿæˆfsimage.chkpointã€‚</p>
</li>
<li><p>ç„¶åå°†fsimage.chkpointæ‹·è´ç»™NameNodeã€‚</p>
</li>
<li><p>é‡å‘½åä¸ºFsimageåæ›¿æ¢æ‰åŸæ¥çš„Fsimageã€‚NameNodeåœ¨å¯åŠ¨æ—¶å°±åªéœ€è¦åŠ è½½ä¹‹å‰æœªåˆå¹¶çš„Editså’ŒFsimageå³å¯ï¼Œå› ä¸ºåˆå¹¶è¿‡çš„Editsä¸­çš„å…ƒæ•°æ®ä¿¡æ¯å·²ç»è¢«è®°å½•åœ¨Fsimageä¸­ã€‚</p>
</li>
</ol>
<p><strong><em>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ2NNä¸NNä¹‹é—´å·®äº†ä¸€ä¸ªedits_inprogress_002ï¼Œæ‰€ä»¥å½“NNæŒ‚äº†çš„æ—¶å€™ï¼Œ2NNä¸èƒ½ç›²ç›®çš„é¡¶ä¸Šå»ã€‚</em></strong></p>
<h2 id="2-Fsimageå’ŒEditsè§£æ"><a href="#2-Fsimageå’ŒEditsè§£æ" class="headerlink" title="2 Fsimageå’ŒEditsè§£æ"></a>2 Fsimageå’ŒEditsè§£æ</h2><h3 id="2-1-Fsimageå’ŒEditsæ¦‚å¿µ"><a href="#2-1-Fsimageå’ŒEditsæ¦‚å¿µ" class="headerlink" title="2.1 Fsimageå’ŒEditsæ¦‚å¿µ"></a>2.1 Fsimageå’ŒEditsæ¦‚å¿µ</h3><ol>
<li><p>Fsimageæ–‡ä»¶ï¼šHDFSæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„ä¸€ä¸ªæ°¸ä¹…æ€§çš„æ£€æŸ¥ç‚¹ï¼Œå…¶ä¸­åŒ…å«HDFSæ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶inodeçš„åºåˆ—åŒ–ä¿¡æ¯ã€‚</p>
</li>
<li><p>Editsæ–‡ä»¶ï¼šå­˜æ”¾HDFSæ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰æ›´æ–°æ“ä½œçš„è·¯å¾„ï¼Œæ–‡ä»¶ç³»ç»Ÿå®¢æˆ·ç«¯æ‰§è¡Œçš„æ‰€æœ‰å†™æ“ä½œé¦–å…ˆä¼šè¢«è®°å½•åˆ°Editsæ–‡ä»¶ä¸­ã€‚</p>
</li>
<li><p>seen_txidæ–‡ä»¶ä¿å­˜çš„æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå°±æ˜¯æœ€åä¸€ä¸ªedits_çš„æ•°å­—</p>
</li>
<li><p>æ¯æ¬¡NameNodeå¯åŠ¨çš„æ—¶å€™éƒ½ä¼šå°†Fsimageæ–‡ä»¶è¯»å…¥å†…å­˜ï¼ŒåŠ è½½Editsé‡Œé¢çš„æ›´æ–°æ“ä½œï¼Œä¿è¯å†…å­˜ä¸­çš„å…ƒæ•°æ®ä¿¡æ¯æ˜¯æœ€æ–°çš„ã€åŒæ­¥çš„ï¼Œå¯ä»¥çœ‹æˆNameNodeå¯åŠ¨çš„æ—¶å€™å°±å°†Fsimageå’ŒEditsæ–‡ä»¶è¿›è¡Œäº†åˆå¹¶ã€‚</p>
</li>
</ol>
<p>æˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥é€šè¿‡catå‘½ä»¤æŸ¥çœ‹Fsimageå’ŒEditsæ–‡ä»¶ï¼Œå› ä¸ºFsimageæ˜¯NNçš„å…ƒæ•°æ®åºåˆ—åŒ–ä»¥åçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨HDFSæä¾›çš„å‘½ä»¤ã€‚</p>
<h3 id="2-2-oivæŸ¥çœ‹Fsimageæ–‡ä»¶"><a href="#2-2-oivæŸ¥çœ‹Fsimageæ–‡ä»¶" class="headerlink" title="2.2 oivæŸ¥çœ‹Fsimageæ–‡ä»¶"></a>2.2 oivæŸ¥çœ‹Fsimageæ–‡ä»¶</h3><ol>
<li>æŸ¥çœ‹oivå’Œoevå‘½ä»¤</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oiv                  apply the offline fsimage viewer to an fsimage</span><br><span class="line">oiv_legacy           apply the offline fsimage viewer to an legacy fsimage</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åŸºæœ¬è¯­æ³•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop001 current]$ hdfs oiv</span><br><span class="line">Usage: bin/hdfs oiv [OPTIONS] -i INPUTFILE -o OUTPUTFILE</span><br><span class="line"></span><br><span class="line">hdfs oiv -p æ–‡ä»¶ç±»å‹ -ié•œåƒæ–‡ä»¶ -o è½¬æ¢åæ–‡ä»¶è¾“å‡ºè·¯å¾„</span><br><span class="line"></span><br><span class="line">-p,--processor &lt;arg&gt;   Select which type of processor to apply</span><br><span class="line">                       against image file. (XML|FileDistribution|Web|Delimited)</span><br><span class="line">                       (Web by default)</span><br><span class="line">é€‰æ‹©è¦åº”ç”¨äºæ–‡ä»¶çš„å¤„ç†å™¨ç±»å‹ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½é€‰æ‹©XMLã€‚</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>è¿™é‡Œæˆ‘ä»¬è½¬ä¸€ä¸‹ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop001 current]$ hdfs oiv -p XML -i fsimage_0000000000000000441 -o fsimage.xml</span><br><span class="line">[fzz001@hadoop001 current]$ cat fsimage.xml</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æŠŠxmlæ–‡ä»¶ç²˜è´´åˆ°ideaé‡Œæ ¼å¼åŒ–ä¸€ä¸‹ï¼Œä¼šå¥½çœ‹å¾ˆå¤šã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">inode</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>16386<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>DIRECTORY<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>wcinput<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mtime</span>&gt;</span>1565909468032<span class="tag">&lt;/<span class="name">mtime</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">permission</span>&gt;</span>fzz001:supergroup:rwxr-xr-x<span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nsquota</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">nsquota</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dsquota</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">dsquota</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">inode</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">inode</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>16387<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>FILE<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>wc.input<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">replication</span>&gt;</span>3<span class="tag">&lt;/<span class="name">replication</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mtime</span>&gt;</span>1565909468006<span class="tag">&lt;/<span class="name">mtime</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">atime</span>&gt;</span>1565909466949<span class="tag">&lt;/<span class="name">atime</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">perferredBlockSize</span>&gt;</span>134217728<span class="tag">&lt;/<span class="name">perferredBlockSize</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">permission</span>&gt;</span>fzz001:supergroup:rw-r--r--<span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">blocks</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">block</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>1073741825<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">genstamp</span>&gt;</span>1001<span class="tag">&lt;/<span class="name">genstamp</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">numBytes</span>&gt;</span>48<span class="tag">&lt;/<span class="name">numBytes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">blocks</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">inode</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰æ–‡ä»¶ç±»å‹ï¼ˆDIRECTORYï¼‰ã€æ–‡ä»¶åç§°ï¼ˆwcinputï¼‰ã€æ—¶é—´æˆ³ï¼ˆ1565909468032ï¼‰ã€æƒé™ã€å‰¯æœ¬æ•°é‡ï¼ˆreplicationï¼‰ã€å—å¤§å°ï¼ˆperferredBlockSizeï¼‰ã€å—åˆ—è¡¨ï¼ˆblocksï¼‰ã€å•å—çš„IDç­‰ç­‰ï¼Œæ¯ä¸€ä¸ªinodeéƒ½æ˜¯ä¸€ä¸ªå…ƒæ•°æ®ä¿¡æ¯ã€‚</p>
<p><strong><font color="red">ä½†æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œå…¶å®å¹¶æ²¡æœ‰è®°å½•å—æ‰€åœ¨çš„DataNodeçš„ä¿¡æ¯ï¼Ÿ</font></strong><br>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼Œå› ä¸ºåœ¨é›†ç¾¤å¯åŠ¨åï¼Œè¦æ±‚DataNodeä¸ŠæŠ¥æ•°æ®å—ä¿¡æ¯ï¼Œå¹¶é—´éš”ä¸€æ®µæ—¶é—´åå†æ¬¡ä¸ŠæŠ¥ï¼Œåé¢çš„å®‰å…¨æ¨¡å¼ä¼šç»†è®²ã€‚</p>
<h3 id="2-3-oevæŸ¥çœ‹Editsæ–‡ä»¶"><a href="#2-3-oevæŸ¥çœ‹Editsæ–‡ä»¶" class="headerlink" title="2.3 oevæŸ¥çœ‹Editsæ–‡ä»¶"></a>2.3 oevæŸ¥çœ‹Editsæ–‡ä»¶</h3><ol>
<li>åŸºæœ¬è¯­æ³•å’Œoivä¸€æ ·</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oev -p æ–‡ä»¶ç±»å‹ -iç¼–è¾‘æ—¥å¿— -o è½¬æ¢åæ–‡ä»¶è¾“å‡ºè·¯å¾„</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿè½¬ä¸€ä¸‹ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop001 current]$ hdfs oev -p XML -i edits_0000000000000000110-0000000000000000210 -o edits.xml</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æŠŠxmlæ–‡ä»¶ç²˜è´´åˆ°ideaé‡Œæ ¼å¼åŒ–ä¸€ä¸‹ï¼Œä¼šå¥½çœ‹å¾ˆå¤šã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RECORD</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">OPCODE</span>&gt;</span>OP_ADD<span class="tag">&lt;/<span class="name">OPCODE</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">DATA</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">TXID</span>&gt;</span>130<span class="tag">&lt;/<span class="name">TXID</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">LENGTH</span>&gt;</span>0<span class="tag">&lt;/<span class="name">LENGTH</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">INODEID</span>&gt;</span>16407<span class="tag">&lt;/<span class="name">INODEID</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">PATH</span>&gt;</span>/hello7.txt<span class="tag">&lt;/<span class="name">PATH</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">REPLICATION</span>&gt;</span>2<span class="tag">&lt;/<span class="name">REPLICATION</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MTIME</span>&gt;</span>1512943607866<span class="tag">&lt;/<span class="name">MTIME</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ATIME</span>&gt;</span>1512943607866<span class="tag">&lt;/<span class="name">ATIME</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">BLOCKSIZE</span>&gt;</span>134217728<span class="tag">&lt;/<span class="name">BLOCKSIZE</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">CLIENT_NAME</span>&gt;</span>DFSClient_NONMAPREDUCE_-1544295051_1<span class="tag">&lt;/<span class="name">CLIENT_NAME</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">CLIENT_MACHINE</span>&gt;</span>172.16.239.100<span class="tag">&lt;/<span class="name">CLIENT_MACHINE</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">OVERWRITE</span>&gt;</span>true<span class="tag">&lt;/<span class="name">OVERWRITE</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">PERMISSION_STATUS</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">USERNAME</span>&gt;</span>fzz001<span class="tag">&lt;/<span class="name">USERNAME</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">GROUPNAME</span>&gt;</span>supergroup<span class="tag">&lt;/<span class="name">GROUPNAME</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">MODE</span>&gt;</span>420<span class="tag">&lt;/<span class="name">MODE</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">PERMISSION_STATUS</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">RPC_CLIENTID</span>&gt;</span>908eafd4-9aec-4288-96f1-e8011d181561<span class="tag">&lt;/<span class="name">RPC_CLIENTID</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">RPC_CALLID</span>&gt;</span>0<span class="tag">&lt;/<span class="name">RPC_CALLID</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">DATA</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RECORD</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°TXIDæ˜¯è‡ªå¢çš„ï¼Œå°±æ˜¯åå­—ä¸Š110~210ä¹‹é—´çš„ï¼Œä¹Ÿå°±æ˜¯æ“ä½œçš„åºå·ã€‚<br>ä¾ç„¶æ˜¯è®°å½•äº†å…ƒæ•°æ®ä¿¡æ¯ï¼Œä½†æ˜¯è¿™äº›éƒ½è¿˜æ˜¯æ²¡æœ‰å†™çš„æ•°æ®ã€‚</p>
<ul>
<li>OPCODEï¼šä¸€ä¸ªæ·»åŠ æ“ä½œ</li>
<li>PATHï¼šæ–‡ä»¶è·¯å¾„</li>
<li>REPLICATIONï¼šå‰¯æœ¬æ•°é‡ã€‚</li>
<li>CLIENT_NAMEï¼šå®¢æˆ·ç«¯åå­—</li>
<li>CLIENT_MACHINEï¼šå®¢æˆ·ç«¯çš„IP.</li>
<li>PERMISSION_STATUSï¼šæƒé™ä¿¡æ¯</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;RECORD&gt;</span><br><span class="line">	&lt;OPCODE&gt;OP_ALLOCATE_BLOCK_ID&lt;/OPCODE&gt;</span><br><span class="line">	&lt;DATA&gt;</span><br><span class="line">		&lt;TXID&gt;131&lt;/TXID&gt;</span><br><span class="line">		&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;</span><br><span class="line">	&lt;/DATA&gt;</span><br><span class="line">&lt;/RECORD&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>OP_ALLOCATE_BLOCK_IDï¼šä¸ºæ–‡ä»¶åˆ†é…å—Idï¼Œç›¸å½“äºè¿”å›çš„DNåœ°å€</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;RECORD&gt;</span><br><span class="line">	&lt;OPCODE&gt;OP_SET_GENSTAMP_V2&lt;/OPCODE&gt;</span><br><span class="line">	&lt;DATA&gt;</span><br><span class="line">		&lt;TXID&gt;132&lt;/TXID&gt;</span><br><span class="line">		&lt;GENSTAMPV2&gt;1016&lt;/GENSTAMPV2&gt;</span><br><span class="line">	&lt;/DATA&gt;</span><br><span class="line">&lt;/RECORD&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>OP_SET_GENSTAMP_V2ï¼šç”³è¯·äº†ä¸€ä¸ªæ—¶é—´æˆ³</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;RECORD&gt;</span><br><span class="line">		&lt;OPCODE&gt;OP_ADD_BLOCK&lt;/OPCODE&gt;</span><br><span class="line">		&lt;DATA&gt;</span><br><span class="line">			&lt;TXID&gt;133&lt;/TXID&gt;</span><br><span class="line">			&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;</span><br><span class="line">			&lt;BLOCK&gt;</span><br><span class="line">				&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;</span><br><span class="line">				&lt;NUM_BYTES&gt;0&lt;/NUM_BYTES&gt;</span><br><span class="line">				&lt;GENSTAMP&gt;1016&lt;/GENSTAMP&gt;</span><br><span class="line">			&lt;/BLOCK&gt;</span><br><span class="line">			&lt;RPC_CLIENTID&gt;&lt;/RPC_CLIENTID&gt;</span><br><span class="line">			&lt;RPC_CALLID&gt;-2&lt;/RPC_CALLID&gt;</span><br><span class="line">		&lt;/DATA&gt;</span><br><span class="line">	&lt;/RECORD&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>OP_ADD_BLOCKï¼šæ·»åŠ å—ï¼Œä¹Ÿå°±è¯´æ•°æ®å·²ç»å†™å®Œï¼ŒæŠŠå—çš„ä¿¡æ¯æ·»åŠ åˆ°å…ƒæ•°æ®é‡Œé¢ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;RECORD&gt;</span><br><span class="line">		&lt;OPCODE&gt;OP_CLOSE&lt;/OPCODE&gt;</span><br><span class="line">		&lt;DATA&gt;</span><br><span class="line">			&lt;TXID&gt;134&lt;/TXID&gt;</span><br><span class="line">			&lt;LENGTH&gt;0&lt;/LENGTH&gt;</span><br><span class="line">			&lt;INODEID&gt;0&lt;/INODEID&gt;</span><br><span class="line">			&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;</span><br><span class="line">			&lt;REPLICATION&gt;2&lt;/REPLICATION&gt;</span><br><span class="line">			&lt;MTIME&gt;1512943608761&lt;/MTIME&gt;</span><br><span class="line">			&lt;ATIME&gt;1512943607866&lt;/ATIME&gt;</span><br><span class="line">			&lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;</span><br><span class="line">			&lt;CLIENT_NAME&gt;&lt;/CLIENT_NAME&gt;</span><br><span class="line">			&lt;CLIENT_MACHINE&gt;&lt;/CLIENT_MACHINE&gt;</span><br><span class="line">			&lt;OVERWRITE&gt;false&lt;/OVERWRITE&gt;</span><br><span class="line">			&lt;BLOCK&gt;</span><br><span class="line">				&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;</span><br><span class="line">				&lt;NUM_BYTES&gt;25&lt;/NUM_BYTES&gt;</span><br><span class="line">				&lt;GENSTAMP&gt;1016&lt;/GENSTAMP&gt;</span><br><span class="line">			&lt;/BLOCK&gt;</span><br><span class="line">			&lt;PERMISSION_STATUS&gt;</span><br><span class="line">				&lt;USERNAME&gt;atguigu&lt;/USERNAME&gt;</span><br><span class="line">				&lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;</span><br><span class="line">				&lt;MODE&gt;420&lt;/MODE&gt;</span><br><span class="line">			&lt;/PERMISSION_STATUS&gt;</span><br><span class="line">		&lt;/DATA&gt;</span><br><span class="line">	&lt;/RECORD&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>OP_CLOSEï¼šå…³é—­æµã€‚</li>
</ul>
<p><strong><font color="red">æ€è€ƒï¼šNameNodeå¦‚ä½•ç¡®å®šä¸‹æ¬¡å¼€æœºå¯åŠ¨çš„æ—¶å€™åˆå¹¶å“ªäº›Editsï¼Ÿ</font></strong><br>æˆ‘ä»¬fsimageåé¢æœ‰ä¸ªç¼–å·ï¼Œè¯´æ˜è¿™ä¸ªç¼–å·ä»¥å‰çš„editséƒ½å·²ç»åˆå¹¶äº†ï¼Œåˆå¹¶æ¥ä¸‹æ¥çš„å°±å¯ä»¥äº†ã€‚</p>
<h2 id="3-CheckPointæ—¶é—´è®¾ç½®"><a href="#3-CheckPointæ—¶é—´è®¾ç½®" class="headerlink" title="3 CheckPointæ—¶é—´è®¾ç½®"></a>3 CheckPointæ—¶é—´è®¾ç½®</h2><ol>
<li>é€šå¸¸æƒ…å†µä¸‹ï¼Œ2NNæ¯éš”ä¸€ä¸ªå°æ—¶è§¦å‘ä¸€æ¬¡åˆå¹¶ã€‚</li>
</ol>
<p><strong><em>hdfs-default.xml</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;3600&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ä¸€åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°ï¼Œå½“æ“ä½œæ¬¡æ•°è¾¾åˆ°1ç™¾ä¸‡æ—¶ï¼ŒSecondaryNameNodeæ‰§è¡Œä¸€æ¬¡ã€‚</li>
</ol>
<p><strong><em>hdfs-default.xml</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;1000000&lt;/value&gt;</span><br><span class="line">&lt;description&gt;æ“ä½œåŠ¨ä½œæ¬¡æ•°&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;60&lt;/value&gt;</span><br><span class="line">&lt;description&gt; 1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ“ä½œæ¬¡æ•°&lt;/description&gt;</span><br><span class="line">&lt;/property &gt;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè‚¯å®šä¸æ˜¯ä¸€æ¬¡æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šä¼ 1KBçš„æ–‡ä»¶å’Œä¸Šä¼ 1GBçš„æ–‡ä»¶æ‰€è¿›è¡Œæ“ä½œæ•°é‡è‚¯å®šä¸ä¸€æ ·ã€‚<br>åœ¨ä¸Šé¢ä¸­æˆ‘ä»¬æåˆ°CheckPointå‡ºå‘æœ‰ä¸¤ä¸ªæ¡ä»¶ï¼Œå…¶å®è¿˜æœ‰ç¬¬ä¸‰ä¸ªï¼šæ¯æ¬¡NNåˆšåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¿›è¡Œä¸€æ¬¡CheckPointï¼ˆåˆå¹¶ï¼‰ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4exas9xj31rk0u0gw4.jpg" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°ï¼Œåœ¨é›†ç¾¤å¯åŠ¨æ—¶å€™ï¼Œæ‰§è¡Œä¸‰ä¸ªæ“ä½œï¼šåŠ è½½fsimageã€åŠ è½½edits.logã€Saving checkpointã€‚å…·ä½“åœ¨é›†ç¾¤ä¸Šæ€ä¹ˆå‘ˆç°çš„å‘¢ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4kkqzb3j310w0ds40z.jpg" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œhadoop001å¯åŠ¨NameNodeã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4mbq6dhj317c06mmz0.jpg" alt=""></p>
<p>è¿›å…¥åˆ°nameæ–‡ä»¶å¤¹ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°currentæ–‡ä»¶å¤¹å’Œin_use.lockï¼Œin_use.lockè¡¨ç¤ºè¿™ä¸ªNameNodeæ­£åœ¨æ‰§è¡Œï¼Œæœ‰è¿™ä¸ªé”å°±è¡¨ç¤ºåˆ«çš„äººä¸èƒ½åŠ¨è¿™ä¸ªå…ƒæ•°æ®äº†ã€‚æˆ‘ä»¬è¿›å…¥åˆ°currentæ–‡ä»¶å¤¹ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c4oogh79j315g0nyk5r.jpg" alt=""></p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬å…ƒæ•°æ®æ•´ä½“å­˜åœ¨çš„ä½ç½®ã€‚edits_0000000000000006670-0000000000000006671 æ„æ€ä¸ºè®°å½•äº†æˆ‘ä»¬ç¬¬6670åˆ°ç¬¬6671æ¬¡æ“ä½œã€‚å› ä¸ºæˆ‘è®¾ç½®çš„æ˜¯ä¸€åˆ†é’Ÿé—´éš”ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°æ¯æ¬¡è®°å½•éƒ½æ˜¯é—´éš”1åˆ†é’Ÿã€‚edits_inprogress_0000000000000013725 ä¸ºæˆ‘ä»¬æ–°å†™çš„inprogressã€‚fsimageä¹‹æ‰€ä»¥æœ‰ä¸¤ä¸ªï¼Œå› ä¸ºfsimageä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥å®ƒåªä¼šä¿ç•™æœ€æ–°çš„å’Œç¬¬äºŒæ–°çš„ï¼Œå‰©ä¸‹éƒ½è¢«åˆ äº†ï¼Œeditsæ°¸è¿œéƒ½ä¸ä¼šè¢«åˆ ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7c54dmyslj311a09ejvs.jpg" alt=""></p>
<p>seen_txid è®°å½•ç€æˆ‘ä»¬ç°åœ¨æ­£åœ¨è®°å½•æ“ä½œçš„edits.inprogressç¼–å·ã€‚</p>
<h2 id="4-NameNodeæ•…éšœå¤„ç†"><a href="#4-NameNodeæ•…éšœå¤„ç†" class="headerlink" title="4 NameNodeæ•…éšœå¤„ç†"></a>4 NameNodeæ•…éšœå¤„ç†</h2><p>NameNodeæ•…éšœåï¼Œå¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹æ³•æ¢å¤æ•°æ®ã€‚</p>
<h3 id="4-1-å°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•"><a href="#4-1-å°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•" class="headerlink" title="4.1 å°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•"></a>4.1 å°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•</h3><ol>
<li><p>kill -9 NameNodeè¿›ç¨‹</p>
</li>
<li><p>åˆ é™¤NameNodeå­˜å‚¨çš„æ•°æ®ï¼ˆ/opt/module/hadoop-2.7.2/data/tmp/dfs/nameï¼‰</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop001 hadoop-2.7.2]$ rm -rf /opt/module/hadoop-2.7.2/data/tmp/dfs/name/*</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æ‹·è´SecondaryNameNodeä¸­æ•°æ®åˆ°åŸNameNodeå­˜å‚¨æ•°æ®ç›®å½•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop001 dfs]$ scp -r atguigu@hadoop104:/opt/module/hadoop-2.7.2/data/tmp/dfs/namesecondary/* ./name/</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>é‡æ–°å¯åŠ¨NameNode</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop001 hadoop-2.7.2]$ sbin/hadoop-daemon.sh start namenode</span><br></pre></td></tr></table></figure>
<h3 id="4-2-ä½¿ç”¨-importCheckpointé€‰é¡¹å¯åŠ¨NameNodeå®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeç›®å½•ä¸­ã€‚"><a href="#4-2-ä½¿ç”¨-importCheckpointé€‰é¡¹å¯åŠ¨NameNodeå®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeç›®å½•ä¸­ã€‚" class="headerlink" title="4.2 ä½¿ç”¨-importCheckpointé€‰é¡¹å¯åŠ¨NameNodeå®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeç›®å½•ä¸­ã€‚"></a>4.2 ä½¿ç”¨-importCheckpointé€‰é¡¹å¯åŠ¨NameNodeå®ˆæŠ¤è¿›ç¨‹ï¼Œä»è€Œå°†SecondaryNameNodeä¸­æ•°æ®æ‹·è´åˆ°NameNodeç›®å½•ä¸­ã€‚</h3><ol>
<li>ä¿®æ”¹hdfs-site.xml</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;120&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;/opt/module/hadoop-2.7.2/data/tmp/dfs/name&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>kill -9 NameNodeè¿›ç¨‹</p>
</li>
<li><p>åˆ é™¤NameNodeå­˜å‚¨çš„æ•°æ®ï¼ˆ/opt/module/hadoop-2.7.2/data/tmp/dfs/nameï¼‰</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop002 hadoop-2.7.2]$ rm -rf /opt/module/hadoop-2.7.2/data/tmp/dfs/name/*</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>å¦‚æœSecondaryNameNodeä¸å’ŒNameNodeåœ¨ä¸€ä¸ªä¸»æœºèŠ‚ç‚¹ä¸Šï¼Œéœ€è¦å°†SecondaryNameNodeå­˜å‚¨æ•°æ®çš„ç›®å½•æ‹·è´åˆ° NameNodeå­˜å‚¨æ•°æ®çš„å¹³çº§ç›®å½•ï¼Œå¹¶åˆ é™¤in_use.lockæ–‡ä»¶</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop002 dfs]$ scp -r atguigu@hadoop104:/opt/module/hadoop-2.7.2/data/tmp/dfs/namesecondary ./</span><br><span class="line"></span><br><span class="line">[fzz001@hadoop002 namesecondary]$ rm -rf in_use.lock</span><br><span class="line"></span><br><span class="line">[fzz001@hadoop002 dfs]$ pwd</span><br><span class="line">/opt/module/hadoop-2.7.2/data/tmp/dfs</span><br><span class="line"></span><br><span class="line">[fzz001@hadoop002 dfs]$ ls</span><br><span class="line">data  name  namesecondary</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>å¯¼å…¥æ£€æŸ¥ç‚¹æ•°æ®ï¼ˆç­‰å¾…ä¸€ä¼šctrl+cç»“æŸæ‰ï¼‰</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop002 hadoop-2.7.2]$ bin/hdfs namenode -importCheckpoint</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>å¯åŠ¨NameNode</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[fzz001@hadoop002 hadoop-2.7.2]$ sbin/hadoop-daemon.sh start namenode</span><br></pre></td></tr></table></figure>

    
  </div>

</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">Chat with me ğŸ¾</span>
      <div class="donation-body">
        <div class="tip text-center">Tell me when you add that you are from the blog</div>
        <ul>
        
          <li class="item">
            
            <img src="/images/WechatIMG5.jpeg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2019/09/25/BD-HDFS-HDFSçš„æ•°æ®æµè¯»å…¥/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="hide pull-right" href="/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              å‹é“¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              æœç´¢
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
    <div id="comment" class="vcomment" ></div>
    <script>
        var notify = 'false' == true ? true : false;
        var verify = 'false' == true ? true : false;
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
            return GUEST_INFO.indexOf(item) > -1
        });
        guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
        window.valine = new Valine({
            el: '.vcomment',
            notify: notify,
            verify: verify,
            appId: "9cprXYUH7H1YKlRERiGS8bxV-gzGzoHsz",
            appKey: "et0Drv2jnj4ILMBUSaNM2M2R",
            avatar:'mm',
            placeholder: "Talk to me ^_^",
            guest_info:guest_info,
            pageSize:'10'
        });
    </script>
  
    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
