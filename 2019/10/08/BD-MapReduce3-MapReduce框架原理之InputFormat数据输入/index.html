<!DOCTYPE html>


  <html class="dark page-post">


<head>
  <meta charset="utf-8">
  <meta name="referrer" content="no-referrer" />
  
  <title>BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥ | MurasakiSeiFu</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="java,redis,nginx,zookeeper,åˆ†å¸ƒå¼ä¸­é—´ä»¶,å¾®æœåŠ¡,springboot,mysql" />
  

  <meta name="description" content="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥ä¸»è¦å†…å®¹ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶  æˆ‘ä»¬çŸ¥é“Mapperå¤„ç†æ•°æ®çš„æ—¶å€™æ˜¯å°†æ•°æ®å˜æˆKVé”®å€¼å¯¹çš„å½¢å¼ï¼Œè¿™ä¸ªè½¬å˜çš„è¿‡ç¨‹æ­£å¼InputFormatæ¥å®ç°çš„ã€‚ Mapperè¾“å‡ºçš„KVé”®å€¼å¯¹æ˜¯æ— åºçš„ï¼Œåˆ°äº†Reducerï¼Œå®ƒæŠŠç›¸åŒçš„æ•°æ®æ±‡åˆ°äº†åŒä¸€ç»„ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšShuffleã€‚è¿™ä¸ªShuffleè¿‡ç¨‹å…¶å®æ˜¯æˆ‘">
<meta property="og:type" content="article">
<meta property="og:title" content="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥">
<meta property="og:url" content="http://ilovenorth.life/2019/10/08/BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥/index.html">
<meta property="og:site_name" content="MurasakiSeiFu">
<meta property="og:description" content="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥ä¸»è¦å†…å®¹ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶  æˆ‘ä»¬çŸ¥é“Mapperå¤„ç†æ•°æ®çš„æ—¶å€™æ˜¯å°†æ•°æ®å˜æˆKVé”®å€¼å¯¹çš„å½¢å¼ï¼Œè¿™ä¸ªè½¬å˜çš„è¿‡ç¨‹æ­£å¼InputFormatæ¥å®ç°çš„ã€‚ Mapperè¾“å‡ºçš„KVé”®å€¼å¯¹æ˜¯æ— åºçš„ï¼Œåˆ°äº†Reducerï¼Œå®ƒæŠŠç›¸åŒçš„æ•°æ®æ±‡åˆ°äº†åŒä¸€ç»„ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšShuffleã€‚è¿™ä¸ªShuffleè¿‡ç¨‹å…¶å®æ˜¯æˆ‘">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7e6fujlh9j30re0d6q3u.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f307bsrsj31qe0u0dmp.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f4419qdmj31r90u0wmb.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f4785r6oj31q50u0tkt.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f6a601a8j31mi0u0tlf.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f6c20bedj31nz0u0qgn.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f92en4g8j30ky0j2tao.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7g6uduvx0j30ki0jmdhv.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7g719tuyoj309609yjrt.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7g73ye1czj31k406aac2.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7qworfri6j31iu0dmgnc.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7qwpjdr9zj31ee0hy0w2.jpg">
<meta property="og:updated_time" content="2019-10-08T09:18:34.473Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥">
<meta name="twitter:description" content="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥ä¸»è¦å†…å®¹ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶  æˆ‘ä»¬çŸ¥é“Mapperå¤„ç†æ•°æ®çš„æ—¶å€™æ˜¯å°†æ•°æ®å˜æˆKVé”®å€¼å¯¹çš„å½¢å¼ï¼Œè¿™ä¸ªè½¬å˜çš„è¿‡ç¨‹æ­£å¼InputFormatæ¥å®ç°çš„ã€‚ Mapperè¾“å‡ºçš„KVé”®å€¼å¯¹æ˜¯æ— åºçš„ï¼Œåˆ°äº†Reducerï¼Œå®ƒæŠŠç›¸åŒçš„æ•°æ®æ±‡åˆ°äº†åŒä¸€ç»„ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšShuffleã€‚è¿™ä¸ªShuffleè¿‡ç¨‹å…¶å®æ˜¯æˆ‘">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/006y8mN6ly1g7e6fujlh9j30re0d6q3u.jpg">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86660611-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?2e6da3c375c8a87f5b664cea6d4cb29c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">ğŸ†</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">ğŸ†</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            å‹é“¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            æœç´¢
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts List</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥"><span class="toc-text">BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸»è¦å†…å®¹"><span class="toc-text">ä¸»è¦å†…å®¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"><span class="toc-text">ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"><span class="toc-text">1.1 åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-é—®é¢˜å¼•å‡º"><span class="toc-text">1. é—®é¢˜å¼•å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"><span class="toc-text">2. MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#äºŒã€Jobæäº¤æµç¨‹æºç å’Œåˆ‡ç‰‡æºç è¯¦è§£"><span class="toc-text">äºŒã€Jobæäº¤æµç¨‹æºç å’Œåˆ‡ç‰‡æºç è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Jobæäº¤æµç¨‹æºç è¯¦è§£"><span class="toc-text">2.1 Jobæäº¤æµç¨‹æºç è¯¦è§£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸‰ã€FileInputFormatå®ç°ç±»"><span class="toc-text">ä¸‰ã€FileInputFormatå®ç°ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-TextInputFormat"><span class="toc-text">3.1 TextInputFormat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-KeyValueTextInputFormat"><span class="toc-text">3.2 KeyValueTextInputFormat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-NLineInputFormat"><span class="toc-text">3.3 NLineInputFormat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-CombineTextInputFormatçš„åˆ‡ç‰‡æœºåˆ¶"><span class="toc-text">3.4 CombineTextInputFormatçš„åˆ‡ç‰‡æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-åº”ç”¨åœºæ™¯"><span class="toc-text">3.4.1 åº”ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®"><span class="toc-text">3.4.2 è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚"><span class="toc-text">4.2 æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-è‡ªå®šä¹‰InputFormatæ¡ˆä¾‹å®æ“"><span class="toc-text">4.2 è‡ªå®šä¹‰InputFormatæ¡ˆä¾‹å®æ“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-éœ€æ±‚"><span class="toc-text">4.2.1 éœ€æ±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-éœ€æ±‚åˆ†æ"><span class="toc-text">4.2.2 éœ€æ±‚åˆ†æ</span></a></li></ol></li></ol></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2019.10.08</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>MurasakiSeiFu.</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Hadoop-MR/">Hadoop-MR</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <meta name="referrer" content="no-referrer">

<h1 id="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥"><a href="#BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥" class="headerlink" title="BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥"></a>BD-MapReduce3-MapReduceæ¡†æ¶åŸç†ä¹‹InputFormatæ•°æ®è¾“å…¥</h1><h2 id="ä¸»è¦å†…å®¹"><a href="#ä¸»è¦å†…å®¹" class="headerlink" title="ä¸»è¦å†…å®¹"></a>ä¸»è¦å†…å®¹</h2><h2 id="ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"><a href="#ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶" class="headerlink" title="ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"></a>ä¸€ã€åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7e6fujlh9j30re0d6q3u.jpg" alt=""></p>
<ul>
<li>æˆ‘ä»¬çŸ¥é“Mapperå¤„ç†æ•°æ®çš„æ—¶å€™æ˜¯å°†æ•°æ®å˜æˆKVé”®å€¼å¯¹çš„å½¢å¼ï¼Œ<br>è¿™ä¸ªè½¬å˜çš„è¿‡ç¨‹æ­£å¼InputFormatæ¥å®ç°çš„ã€‚</li>
<li>Mapperè¾“å‡ºçš„KVé”®å€¼å¯¹æ˜¯æ— åºçš„ï¼Œåˆ°äº†Reducerï¼Œå®ƒæŠŠç›¸åŒçš„æ•°æ®æ±‡åˆ°äº†åŒä¸€ç»„ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšShuffleã€‚<font color="red">è¿™ä¸ªShuffleè¿‡ç¨‹å…¶å®æ˜¯æˆ‘ä»¬äººä¸ºåˆ’åˆ†çš„ï¼Œå…¶å®Shuffleé˜¶æ®µæ˜¯ç”±MapTaskçš„ååŠæ®µå’ŒReduceTaskçš„å‰åŠæ®µå…±åŒç»„æˆçš„ã€‚</font></li>
<li>Reducerå°†KVå€¼ç»“æœè¾“å‡ºåˆ°å¤–éƒ¨æ–‡ä»¶ï¼Œé€šè¿‡OutPutFormatæ¥å®ç°ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ä¸»è¦éƒ¨åˆ†ã€‚</p>
<h3 id="1-1-åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"><a href="#1-1-åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶" class="headerlink" title="1.1 åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"></a>1.1 åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</h3><h4 id="1-é—®é¢˜å¼•å‡º"><a href="#1-é—®é¢˜å¼•å‡º" class="headerlink" title="1. é—®é¢˜å¼•å‡º"></a>1. é—®é¢˜å¼•å‡º</h4><p><strong><em>MapTaskçš„å¹¶è¡Œåº¦å†³å®šMapé˜¶æ®µçš„ä»»åŠ¡å¤„ç†å¹¶å‘åº¦ï¼Œè¿›è€Œå½±å“åˆ°æ•´ä¸ªJobçš„å¤„ç†é€Ÿåº¦ã€‚</em></strong></p>
<font color="#5555FF">Qï¼š1Gçš„æ•°æ®ï¼Œå¯åŠ¨8ä¸ªMapTaskï¼Œå¯ä»¥æé«˜é›†ç¾¤çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚é‚£ä¹ˆ1Kçš„æ•°æ®ï¼Œä¹Ÿå¯åŠ¨8ä¸ªMapTaskï¼Œä¼šæé«˜é›†ç¾¤æ€§èƒ½å—ï¼ŸMapTaskå¹¶è¡Œä»»åŠ¡æ˜¯å¦è¶Šå¤šè¶Šå¥½å‘¢ï¼Ÿå“ªäº›å› ç´ å½±å“äº†MapTaskå¹¶è¡Œåº¦ï¼Ÿ</font>

<p>æ•°æ®åˆ’åˆ†å°±æ˜¯ç”±InputFormatæ¥å®Œæˆçš„ï¼Œå‡å¦‚æˆ‘ä»¬åˆ’åˆ†äº†8ä»½ï¼Œä¸€ä»½128Mï¼Œå¯åŠ¨äº†å“åº”æ•°é‡çš„Maptaskæ¥å¤„ç†æ•°æ®ï¼Œå¹¶è¡Œåº¦ä¹Ÿå°±ä¸º8ã€‚</p>
<h4 id="2-MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"><a href="#2-MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶" class="headerlink" title="2. MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶"></a>2. MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</h4><p><strong>æ•°æ®å—</strong>ï¼šBlockæ˜¯HDFSåœ¨ç‰©ç†ä¸ŠæŠŠæ•°æ®åˆ†æˆä¸€å—ä¸€å—çš„å•ä½ã€‚<br><strong>æ•°æ®åˆ‡ç‰‡</strong>ï¼šæ•°æ®åˆ‡ç‰‡åªæ˜¯åœ¨é€»è¾‘ä¸Šå¯¹è¾“å…¥è¿›è¡Œåˆ†ç‰‡ï¼Œå¹¶ä¸ä¼šåœ¨ç£ç›˜ä¸Šå°†å…¶åˆ‡åˆ†æˆç‰‡è¿›è¡Œå­˜å‚¨ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ª300Mçš„æ–‡ä»¶ï¼ŒHDFSçš„å—å¤§å°é»˜è®¤ä¸º128Mï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹ŸæŒ‰ç…§128Mçš„å¤§å°æ¥åˆ‡æ–‡ä»¶ã€‚å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰100Mçš„å¤§å°æ¥åˆ‡åˆ†æ–‡ä»¶ï¼Œä¼šæ˜¯ä»€ä¹ˆæ•ˆæœã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f307bsrsj31qe0u0dmp.jpg" alt=""></p>
<p>æŒ‰100Måˆ‡åˆ†ï¼Œæ¯ä¸ªMapTaskç¡®å®å¤„ç†æ–‡ä»¶å¤§å°å˜å°äº†ï¼Œæ¯ä¸ªMapTaskå¤„ç†æ–‡ä»¶çš„æ—¶é—´ä¹Ÿå˜çŸ­äº†<strong><em>ï¼ˆèŠ‚ç‚¹ä¸Šçš„è¿™ä¸ªæ–‡ä»¶ä¼šäº¤ç»™è¯¥èŠ‚ç‚¹ä¸Šçš„MapTaskæ¥å¤„ç†ï¼Œè¿™æ˜¯yarnçš„ä¸€ä¸ªä¼˜åŒ–åŸåˆ™ï¼Œæœ¬åœ°æ•°æ®å°½é‡åœ¨æœ¬åœ°çš„MapTaskä¸Šå¤„ç†ï¼Œä¹Ÿå°±æ˜¯hadoop002ä¸Šçš„æ–‡ä»¶ä¸€èˆ¬éƒ½ä¼šäº¤ç»™hadoop002æœºå™¨çš„MRæ¥å¤„ç†ï¼Œä¸ºäº†é¿å…ç½‘ç»œä¼ è¾“ï¼‰</em></strong>ã€‚ä½†æ˜¯MRæ¡†æ¶å°±ä¸çˆ½äº†ï¼Œå› ä¸ºä¸€å—çš„å¤§å°ä¸º128Mï¼Œç„¶è€Œæˆ‘ä»¬çš„MapTaskæŒ‰100Mçš„å¤§å°åˆ‡æ–‡ä»¶ï¼Œå°†0~100Mäº¤ç»™DN1çš„MapTaskæ¥å¤„ç†ï¼Œç¬¬äºŒä¸ª100Mäº¤ç»™DN2çš„MapTaskæ¥å¤„ç†ï¼Œ<font color="red">ä½†æ˜¯ç¬¬äºŒå—100Mï¼Œå…¶ä¸­ï¼Œæœ‰28Måœ¨ç¬¬ä¸€ä¸ªDNä¸­ï¼Œè¿™å°±é¢ä¸´ç€28Mçš„ç½‘ç»œä¼ è¾“ï¼ŒåŒç†ç®—ä¸Šç¬¬ä¸‰å—ï¼Œä¸€å…±äº§ç”Ÿäº†84Mçš„ç½‘ç»œä¼ è¾“ã€‚å°½ç®¡MapTaskå¤„ç†æ•ˆç‡ä¸Šå‡äº†ï¼Œä½†æ˜¯å¾—ä¸å¿å¤±ï¼Œå¤±åœ¨äº†ç½‘ç»œä¼ è¾“ä¸Šäº†ã€‚</font></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f4419qdmj31r90u0wmb.jpg" alt=""></p>
<p>å¦‚æœæˆ‘ä»¬çš„MapTaskæŒ‰ç…§128Mæ¥åˆ‡åˆ†æ–‡ä»¶ï¼Œå°½ç®¡æ¯ä¸ªMapTaskå¤„ç†çš„æ–‡ä»¶å˜å¤§äº†ï¼Œä½†æ˜¯çœå»äº†ç½‘è·¯ä¼ è¾“ï¼Œæ•´ä½“çš„æ€§èƒ½å…¶å®æ˜¯æ›´ä¼˜çš„ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f4785r6oj31q50u0tkt.jpg" alt=""></p>
<p>åœ¨æ€»ç»“ä¸­ï¼Œè¯´ä¸€ä¸‹ç¬¬å››ç‚¹ã€‚    </p>
<p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æ€»å…±æœ‰500Mçš„æ–‡ä»¶ï¼Œä¸è¿‡æ˜¯3ä¸ªæ–‡ä»¶æ±‡æ€»çš„ï¼Œ300ã€100ã€100ï¼Œæ­¤æ—¶ï¼Œåˆ‡ç‰‡æ˜¯é’ˆå¯¹å•ä¸€æ–‡ä»¶çš„ï¼Œä¹Ÿå°±è¯´300Måˆ‡ä½3ç‰‡ï¼Œ100Mä¸ºä¸€ç‰‡ï¼Œæœ€åçš„100Mä¸ºä¸€ç‰‡ã€‚</p>
<h2 id="äºŒã€Jobæäº¤æµç¨‹æºç å’Œåˆ‡ç‰‡æºç è¯¦è§£"><a href="#äºŒã€Jobæäº¤æµç¨‹æºç å’Œåˆ‡ç‰‡æºç è¯¦è§£" class="headerlink" title="äºŒã€Jobæäº¤æµç¨‹æºç å’Œåˆ‡ç‰‡æºç è¯¦è§£"></a>äºŒã€Jobæäº¤æµç¨‹æºç å’Œåˆ‡ç‰‡æºç è¯¦è§£</h2><h3 id="2-1-Jobæäº¤æµç¨‹æºç è¯¦è§£"><a href="#2-1-Jobæäº¤æµç¨‹æºç è¯¦è§£" class="headerlink" title="2.1 Jobæäº¤æµç¨‹æºç è¯¦è§£"></a>2.1 Jobæäº¤æµç¨‹æºç è¯¦è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">waitForCompletion()</span><br><span class="line"></span><br><span class="line">submit();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1å»ºç«‹è¿æ¥</span></span><br><span class="line">	connect();	</span><br><span class="line">		<span class="comment">// 1ï¼‰åˆ›å»ºæäº¤Jobçš„ä»£ç†</span></span><br><span class="line">		<span class="keyword">new</span> Cluster(getConfiguration());</span><br><span class="line">			<span class="comment">// ï¼ˆ1ï¼‰åˆ¤æ–­æ˜¯æœ¬åœ°yarnè¿˜æ˜¯è¿œç¨‹</span></span><br><span class="line">			initialize(jobTrackAddr, conf); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 æäº¤job</span></span><br><span class="line">submitter.submitJobInternal(Job.<span class="keyword">this</span>, cluster)</span><br><span class="line">	<span class="comment">// 1ï¼‰åˆ›å»ºç»™é›†ç¾¤æäº¤æ•°æ®çš„Stagè·¯å¾„</span></span><br><span class="line">	Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2ï¼‰è·å–jobid ï¼Œå¹¶åˆ›å»ºJobè·¯å¾„</span></span><br><span class="line">	JobID jobId = submitClient.getNewJobID();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3ï¼‰æ‹·è´jaråŒ…åˆ°é›†ç¾¤</span></span><br><span class="line">copyAndConfigureFiles(job, submitJobDir);	</span><br><span class="line">	rUploader.uploadFiles(job, jobSubmitDir);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4ï¼‰è®¡ç®—åˆ‡ç‰‡ï¼Œç”Ÿæˆåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶</span></span><br><span class="line">writeSplits(job, submitJobDir);</span><br><span class="line">		maps = writeNewSplits(job, jobSubmitDir);</span><br><span class="line">		<span class="comment">// åˆ‡ç‰‡è§„åˆ™ è¢«åˆ‡æ–‡ä»¶å¤§å°æ˜¯å¦å¤§äº128Mçš„1.1å€</span></span><br><span class="line">		input.getSplits(job);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5ï¼‰å‘Stagè·¯å¾„å†™XMLé…ç½®æ–‡ä»¶</span></span><br><span class="line">writeConf(conf, submitJobFile);</span><br><span class="line">	conf.writeXml(out);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6ï¼‰æäº¤Job,è¿”å›æäº¤çŠ¶æ€</span></span><br><span class="line">status = submitClient.submitJob(jobId, submitJobDir.toString(), job.getCredentials());</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f6a601a8j31mi0u0tlf.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f6c20bedj31nz0u0qgn.jpg" alt=""></p>
<h2 id="ä¸‰ã€FileInputFormatå®ç°ç±»"><a href="#ä¸‰ã€FileInputFormatå®ç°ç±»" class="headerlink" title="ä¸‰ã€FileInputFormatå®ç°ç±»"></a>ä¸‰ã€FileInputFormatå®ç°ç±»</h2><p>æ€è€ƒï¼š<font color="red">åœ¨è¿è¡ŒMapReduceç¨‹åºæ—¶ï¼Œè¾“å…¥çš„æ–‡ä»¶æ ¼å¼åŒ…æ‹¬ï¼šåŸºäºè¡Œçš„æ—¥å¿—æ–‡ä»¶ã€äºŒè¿›åˆ¶æ ¼å¼æ–‡ä»¶ã€æ•°æ®åº“è¡¨ç­‰ã€‚</font>é‚£ä¹ˆï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹ï¼ŒMapReduceæ˜¯å¦‚ä½•è¯»å–è¿™äº›æ•°æ®çš„å‘¢ï¼Ÿ</p>
<p>FileInputFormatå¸¸è§çš„æ¥å£å®ç°ç±»åŒ…æ‹¬ï¼š<font color="red">TextInputFormatã€KeyValueTextInputFormatã€NLineInputFormatã€CombineTextInputFormatå’Œè‡ªå®šä¹‰InputFormatç­‰ã€‚</font></p>
<h2 id="3-1-TextInputFormat"><a href="#3-1-TextInputFormat" class="headerlink" title="3.1 TextInputFormat"></a>3.1 TextInputFormat</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7f92en4g8j30ky0j2tao.jpg" alt=""></p>
<p>TextInputFormatæ˜¯é»˜è®¤çš„FileInputFormatå®ç°ç±»ã€‚æŒ‰è¡Œè¯»å–æ¯æ¡è®°å½•ã€‚é”®æ˜¯å­˜å‚¨è¯¥è¡Œåœ¨æ•´ä¸ªæ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚åç§»é‡ï¼Œ LongWritableç±»å‹ã€‚å€¼æ˜¯è¿™è¡Œçš„å†…å®¹ï¼Œä¸åŒ…æ‹¬ä»»ä½•è¡Œç»ˆæ­¢ç¬¦ï¼ˆæ¢è¡Œç¬¦å’Œå›è½¦ç¬¦ï¼‰ï¼ŒTextç±»å‹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªåˆ†ç‰‡åŒ…å«äº†å¦‚ä¸‹4æ¡æ–‡æœ¬è®°å½•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rich learning form</span><br><span class="line">Intelligent learning engine</span><br><span class="line">Learning more convenient</span><br><span class="line">From the real demand for more close to the enterprise</span><br></pre></td></tr></table></figure>
<p>æ¯æ¡è®°å½•è¡¨ç¤ºä¸ºä»¥ä¸‹é”®/å€¼å¯¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(0,Rich learning form)</span><br><span class="line">(19,Intelligent learning engine)</span><br><span class="line">(47,Learning more convenient)</span><br><span class="line">(72,From the real demand for more close to the enterprise)</span><br></pre></td></tr></table></figure>
<h2 id="3-2-KeyValueTextInputFormat"><a href="#3-2-KeyValueTextInputFormat" class="headerlink" title="3.2 KeyValueTextInputFormat"></a>3.2 KeyValueTextInputFormat</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7g6uduvx0j30ki0jmdhv.jpg" alt=""></p>
<p>æ¯ä¸€è¡Œå‡ä¸ºä¸€æ¡è®°å½•ï¼Œè¢«åˆ†éš”ç¬¦åˆ†å‰²ä¸ºkeyï¼Œvalueã€‚å¯ä»¥é€šè¿‡åœ¨é©±åŠ¨ç±»ä¸­è®¾ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conf.set(KeyValueLineRecordReader.KEY_VALUE_SEPERATOR, &quot;\t&quot;);æ¥è®¾å®šåˆ†éš”ç¬¦ã€‚</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤åˆ†éš”ç¬¦æ˜¯tabï¼ˆ\tï¼‰ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªåŒ…å«4æ¡è®°å½•çš„åˆ†ç‰‡ã€‚å…¶ä¸­â€”â€”&gt;è¡¨ç¤ºä¸€ä¸ªï¼ˆæ°´å¹³æ–¹å‘çš„ï¼‰åˆ¶è¡¨ç¬¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">line1 â€”â€”&gt;Rich learning form</span><br><span class="line">line2 â€”â€”&gt;Intelligent learning engine</span><br><span class="line">line3 â€”â€”&gt;Learning more convenient</span><br><span class="line">line4 â€”â€”&gt;From the real demand for more close to the enterprise</span><br></pre></td></tr></table></figure>
<p>æ¯æ¡è®°å½•è¡¨ç¤ºä¸ºä»¥ä¸‹é”®/å€¼å¯¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(line1,Rich learning form)</span><br><span class="line">(line2,Intelligent learning engine)</span><br><span class="line">(line3,Learning more convenient)</span><br><span class="line">(line4,From the real demand for more close to the enterprise)</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„é”®æ˜¯æ¯è¡Œæ’åœ¨åˆ¶è¡¨ç¬¦ä¹‹å‰çš„Textåºåˆ—ã€‚</p>
<h2 id="3-3-NLineInputFormat"><a href="#3-3-NLineInputFormat" class="headerlink" title="3.3 NLineInputFormat"></a>3.3 NLineInputFormat</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7g719tuyoj309609yjrt.jpg" alt=""></p>
<p>å¦‚æœä½¿ç”¨NlineInputFormatï¼Œä»£è¡¨æ¯ä¸ªmapè¿›ç¨‹å¤„ç†çš„<font color="red">InputSplitä¸å†æŒ‰Blockå—å»åˆ’åˆ†ï¼Œè€Œæ˜¯æŒ‰NlineInputFormatæŒ‡å®šçš„è¡Œæ•°Næ¥åˆ’åˆ†ã€‚</font>å³è¾“å…¥æ–‡ä»¶çš„æ€»è¡Œæ•°/N=åˆ‡ç‰‡æ•°ï¼Œå¦‚æœä¸æ•´é™¤ï¼Œåˆ‡ç‰‡æ•°=å•†+1ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œä»ç„¶ä»¥ä¸Šé¢çš„4è¡Œè¾“å…¥ä¸ºä¾‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rich learning form</span><br><span class="line">Intelligent learning engine</span><br><span class="line">Learning more convenient</span><br><span class="line">From the real demand for more close to the enterprise</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œå¦‚æœNæ˜¯2ï¼Œåˆ™æ¯ä¸ªè¾“å…¥åˆ†ç‰‡åŒ…å«ä¸¤è¡Œã€‚å¼€å¯2ä¸ªMapTaskã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(0,Rich learning form)</span><br><span class="line">(19,Intelligent learning engine)</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ª mapper åˆ™æ”¶åˆ°åä¸¤è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(47,Learning more convenient)</span><br><span class="line">(72,From the real demand for more close to the enterprise)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„é”®å’Œå€¼ä¸TextInputFormatç”Ÿæˆçš„ä¸€æ ·ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7g73ye1czj31k406aac2.jpg" alt=""></p>
<h2 id="3-4-CombineTextInputFormatçš„åˆ‡ç‰‡æœºåˆ¶"><a href="#3-4-CombineTextInputFormatçš„åˆ‡ç‰‡æœºåˆ¶" class="headerlink" title="3.4 CombineTextInputFormatçš„åˆ‡ç‰‡æœºåˆ¶"></a>3.4 CombineTextInputFormatçš„åˆ‡ç‰‡æœºåˆ¶</h2><p>æ¡†æ¶é»˜è®¤çš„TextInputFormatåˆ‡ç‰‡æœºåˆ¶æ˜¯å¯¹ä»»åŠ¡æŒ‰æ–‡ä»¶è§„åˆ’åˆ‡ç‰‡ï¼Œ<font color="red">ä¸ç®¡æ–‡ä»¶å¤šå°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡ï¼Œ</font>éƒ½ä¼šäº¤ç»™ä¸€ä¸ªMapTaskï¼Œè¿™æ ·å¦‚æœæœ‰å¤§é‡å°æ–‡ä»¶ï¼Œ<font color="red">å°±ä¼šäº§ç”Ÿå¤§é‡çš„MapTaskï¼Œå¤„ç†æ•ˆç‡æå…¶ä½ä¸‹ã€‚</font></p>
<h3 id="3-4-1-åº”ç”¨åœºæ™¯"><a href="#3-4-1-åº”ç”¨åœºæ™¯" class="headerlink" title="3.4.1 åº”ç”¨åœºæ™¯"></a>3.4.1 åº”ç”¨åœºæ™¯</h3><p>CombineTextInputFormatç”¨äºå°æ–‡ä»¶è¿‡å¤šçš„åœºæ™¯ï¼Œ<font color="red">å®ƒå¯ä»¥å°†å¤šä¸ªå°æ–‡ä»¶ä»é€»è¾‘ä¸Šè§„åˆ’åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œ</font>è¿™æ ·ï¼Œå¤šä¸ªå°æ–‡ä»¶å°±å¯ä»¥äº¤ç»™ä¸€ä¸ªMapTaskå¤„ç†ã€‚</p>
<h3 id="3-4-2-è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®"><a href="#3-4-2-è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®" class="headerlink" title="3.4.2 è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®"></a>3.4.2 è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CombineTextInputFormat.setMaxInputSplitSize(job, <span class="number">4194304</span>);<span class="comment">// 4M</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šè™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®æœ€å¥½æ ¹æ®å®é™…çš„å°æ–‡ä»¶å¤§å°æƒ…å†µæ¥è®¾ç½®å…·ä½“çš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 3.4.3 åˆ‡ç‰‡æœºåˆ¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç”Ÿæˆåˆ‡ç‰‡è¿‡ç¨‹åŒ…æ‹¬ï¼šè™šæ‹Ÿå­˜å‚¨è¿‡ç¨‹å’Œåˆ‡ç‰‡è¿‡ç¨‹äºŒéƒ¨åˆ†ã€‚</span><br><span class="line"></span><br><span class="line">![](https:<span class="comment">//tva1.sinaimg.cn/large/006y8mN6ly1g7qktxrqvdj31550kzn0h.jpg)</span></span><br><span class="line"></span><br><span class="line">**<span class="number">1</span>.è™šæ‹Ÿå­˜å‚¨è¿‡ç¨‹ï¼š**</span><br><span class="line"></span><br><span class="line">å°†è¾“å…¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œä¾æ¬¡å’Œè®¾ç½®çš„setMaxInputSplitSizeå€¼æ¯”è¾ƒï¼Œå¦‚æœä¸å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ï¼Œé€»è¾‘ä¸Šåˆ’åˆ†ä¸€ä¸ªå—ã€‚å¦‚æœè¾“å…¥æ–‡ä»¶å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ä¸”å¤§äºä¸¤å€ï¼Œé‚£ä¹ˆä»¥æœ€å¤§å€¼åˆ‡å‰²ä¸€å—ï¼›&lt;font color="red"&gt;å½“å‰©ä½™æ•°æ®å¤§å°è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼ä¸”ä¸å¤§äºæœ€å¤§å€¼2å€ï¼Œæ­¤æ—¶å°†æ–‡ä»¶å‡åˆ†æˆ2ä¸ªè™šæ‹Ÿå­˜å‚¨å—ï¼ˆé˜²æ­¢å‡ºç°å¤ªå°åˆ‡ç‰‡ï¼‰ã€‚&lt;/font&gt;</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚setMaxInputSplitSizeå€¼ä¸º<span class="number">4</span>Mï¼Œè¾“å…¥æ–‡ä»¶å¤§å°ä¸º<span class="number">8.02</span>Mï¼Œåˆ™å…ˆé€»è¾‘ä¸Šåˆ†æˆä¸€ä¸ª<span class="number">4</span>Mã€‚å‰©ä½™çš„å¤§å°ä¸º<span class="number">4.02</span>Mï¼Œå¦‚æœæŒ‰ç…§<span class="number">4</span>Mé€»è¾‘åˆ’åˆ†ï¼Œå°±ä¼šå‡ºç°<span class="number">0.02</span>Mçš„å°çš„è™šæ‹Ÿå­˜å‚¨æ–‡ä»¶ï¼Œæ‰€ä»¥å°†å‰©ä½™çš„<span class="number">4.02</span>Mæ–‡ä»¶åˆ‡åˆ†æˆï¼ˆ<span class="number">2.01</span>Må’Œ<span class="number">2.01</span>Mï¼‰ä¸¤ä¸ªæ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">**<span class="number">2</span>.åˆ‡ç‰‡è¿‡ç¨‹**</span><br><span class="line"></span><br><span class="line">* åˆ¤æ–­è™šæ‹Ÿå­˜å‚¨çš„æ–‡ä»¶å¤§å°æ˜¯å¦å¤§äºsetMaxInputSplitSizeå€¼ï¼Œå¤§äºç­‰äºåˆ™å•ç‹¬å½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</span><br><span class="line">* å¦‚æœä¸å¤§äºåˆ™è·Ÿä¸‹ä¸€ä¸ªè™šæ‹Ÿå­˜å‚¨æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå…±åŒå½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</span><br><span class="line">* &lt;font color="red"&gt;æµ‹è¯•ä¸¾ä¾‹ï¼šæœ‰4ä¸ªå°æ–‡ä»¶å¤§å°åˆ†åˆ«ä¸º1.7Mã€5.1Mã€3.4Mä»¥åŠ6.8Mè¿™å››ä¸ªå°æ–‡ä»¶ï¼Œåˆ™è™šæ‹Ÿå­˜å‚¨ä¹‹åå½¢æˆ6ä¸ªæ–‡ä»¶å—ï¼Œå¤§å°åˆ†åˆ«ä¸ºï¼š&lt;/font&gt;</span><br></pre></td></tr></table></figure>
<p>1.7Mã€ï¼ˆ2.55Mã€2.55Mï¼‰ã€3.4Mã€ä»¥åŠï¼ˆ3.4Mã€3.4Mï¼‰<br>æœ€ç»ˆä¼šå½¢æˆ3ä¸ªåˆ‡ç‰‡ï¼Œå¤§å°åˆ†åˆ«ä¸ºï¼š<br>ï¼ˆ1.7+2.55ï¼‰Mã€ï¼ˆ2.55+3.4ï¼‰Mã€ï¼ˆ3.4+3.4ï¼‰M<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## å››ã€è‡ªå®šä¹‰InputFormatå®ç°ç±»</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 4.1 è‡ªå®šä¹‰InputFormatå‡†å¤‡æ­¥éª¤</span><br><span class="line"></span><br><span class="line">åœ¨ä¼ä¸šå¼€å‘ä¸­ï¼ŒHadoopæ¡†æ¶è‡ªå¸¦çš„InputFormatç±»å‹ä¸èƒ½æ»¡è¶³æ‰€æœ‰åº”ç”¨åœºæ™¯ï¼Œéœ€è¦è‡ªå®šä¹‰InputFormatæ¥è§£å†³å®é™…é—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**è‡ªå®šä¹‰InputFormatå‡†å¤‡æ­¥éª¤å¦‚ä¸‹ï¼š**</span><br><span class="line"></span><br><span class="line">1. è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿FileInputFormatã€‚ï¼ˆå‡†å¤‡æ­¥éª¤ï¼‰</span><br><span class="line">2. æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚ï¼ˆå‡†å¤‡æ­¥éª¤ï¼‰</span><br><span class="line">3. åœ¨è¾“å‡ºæ—¶ä½¿ç”¨SequenceFileOutPutFormatè¾“å‡ºåˆå¹¶æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 4.1 è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿FileInputFormatã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```Java</span><br><span class="line">import org.apache.hadoop.io.BytesWritable;</span><br><span class="line">import org.apache.hadoop.io.Text;</span><br><span class="line">import org.apache.hadoop.mapreduce.InputSplit;</span><br><span class="line">import org.apache.hadoop.mapreduce.RecordReader;</span><br><span class="line">import org.apache.hadoop.mapreduce.TaskAttemptContext;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ³›å‹: K ä¸º Textï¼ˆæ–‡ä»¶åï¼‰ V ä¸º BytesWritableï¼ˆä¸€æ®µ2è¿›åˆ¶æ•°å€¼ï¼‰</span><br><span class="line"> *</span><br><span class="line"> * @ClassName : WholeFileInputFormat</span><br><span class="line"> * @Description : TODO</span><br><span class="line"> * @Author : murasaki</span><br><span class="line"> * @Date : 2019-10-08 10:58</span><br><span class="line"> * @Version : 1.0</span><br><span class="line"> */</span><br><span class="line">public class WholeFileInputFormat extends FileInputFormat&lt;Text, BytesWritable&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    public RecordReader&lt;Text, BytesWritable&gt; createRecordReader(InputSplit split, TaskAttemptContext context) throws IOException, InterruptedException &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="4-2-æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚"><a href="#4-2-æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚" class="headerlink" title="4.2 æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚"></a>4.2 æ”¹å†™RecordReaderï¼Œå®ç°ä¸€æ¬¡è¯»å–ä¸€ä¸ªå®Œæ•´æ–‡ä»¶å°è£…ä¸ºKVã€‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.BytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.InputSplit;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.RecordReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.TaskAttemptContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰RRï¼Œå¤„ç†ä¸€ä¸ªæ–‡ä»¶ï¼šæŠŠè¿™ä¸ªæ–‡ä»¶ç›´æ¥éƒ½åŸä¸€ä¸ªKVå€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> : WholeFileRecordReader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : murasaki</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> : 2019-10-08 11:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> : 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WholeFileRecordReader</span> <span class="keyword">extends</span> <span class="title">RecordReader</span>&lt;<span class="title">Text</span>, <span class="title">BytesWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¡†æ¶ä¼šåœ¨å¼€å§‹çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> MurasakiSeiFu</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:06 2019-10-08</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> [split, context]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(InputSplit split, TaskAttemptContext context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–ä¸‹ä¸€ç»„KVå€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> MurasakiSeiFu</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:09 2019-10-08</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> []</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœè¯»åˆ°äº†ï¼Œè¿”å›trueï¼›è¯»å®Œäº†ï¼Œè¿”å›false</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">nextKeyValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰è¯»åˆ°çš„Key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çš„Key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Text <span class="title">getCurrentKey</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰è¯»åˆ°çš„Value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çš„Value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BytesWritable <span class="title">getCurrentValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰æ•°æ®è¯»å–è¿›åº¦ï¼ˆæˆ‘ä»¬æ‰§è¡ŒMRçš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°Maperæ‰§è¡Œåˆ°ç™¾åˆ†ä¹‹å‡ ï¼Œå°±æ˜¯ä»è¿™é‡Œæ¥çš„ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çš„è¿›åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getProgress</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­èµ„æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-è‡ªå®šä¹‰InputFormatæ¡ˆä¾‹å®æ“"><a href="#4-2-è‡ªå®šä¹‰InputFormatæ¡ˆä¾‹å®æ“" class="headerlink" title="4.2 è‡ªå®šä¹‰InputFormatæ¡ˆä¾‹å®æ“"></a>4.2 è‡ªå®šä¹‰InputFormatæ¡ˆä¾‹å®æ“</h3><p>æ— è®ºHDFSè¿˜æ˜¯MapReduceï¼Œåœ¨å¤„ç†å°æ–‡ä»¶æ—¶æ•ˆç‡éƒ½éå¸¸ä½ï¼Œä½†åˆéš¾å…é¢ä¸´å¤„ç†å¤§é‡å°æ–‡ä»¶çš„åœºæ™¯ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦æœ‰ç›¸åº”è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥è‡ªå®šä¹‰InputFormatå®ç°å°æ–‡ä»¶çš„åˆå¹¶ã€‚</p>
<h4 id="4-2-1-éœ€æ±‚"><a href="#4-2-1-éœ€æ±‚" class="headerlink" title="4.2.1 éœ€æ±‚"></a>4.2.1 éœ€æ±‚</h4><p>å°†å¤šä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªSequenceFileæ–‡ä»¶ï¼ˆSequenceFileæ–‡ä»¶æ˜¯Hadoopç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶å½¢å¼çš„key-valueå¯¹çš„æ–‡ä»¶æ ¼å¼ï¼‰ï¼ŒSequenceFileé‡Œé¢å­˜å‚¨ç€å¤šä¸ªæ–‡ä»¶ï¼Œå­˜å‚¨çš„å½¢å¼ä¸ºã€æ–‡ä»¶è·¯å¾„+åç§°ã€‘ä¸ºkeyï¼Œã€æ–‡ä»¶å†…å®¹ã€‘ä¸ºvalueã€‚</p>
<ol>
<li>è¾“å…¥æ•°æ®: one.txt two.txt three.txt</li>
<li>æœŸæœ›è¾“å‡ºæ–‡ä»¶æ ¼å¼: part-r-0000</li>
</ol>
<h4 id="4-2-2-éœ€æ±‚åˆ†æ"><a href="#4-2-2-éœ€æ±‚åˆ†æ" class="headerlink" title="4.2.2 éœ€æ±‚åˆ†æ"></a>4.2.2 éœ€æ±‚åˆ†æ</h4><p>å› ä¸ºéœ€æ±‚ä¸­è¯´<font color="red">å°†å¤šä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªSequenceFileæ–‡ä»¶</font>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„<strong>FileInputFormat</strong>ç±»ä¸­é‡å†™<strong><em>isSplitable()</em></strong>æ–¹æ³•ï¼Œè¿”å›falseï¼Œä¸å¯åˆ†å‰²ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isSplitable</span><span class="params">(JobContext context, Path filename)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œç¬¬ä¸€ä»¶äº‹ï¼Œæˆ‘ä»¬å…ˆå®Œæˆ<strong>è‡ªå®šä¹‰RR</strong>ä¸­çš„<strong><em>getProgress()</em></strong>æ–¹æ³•ï¼Œå¼€å§‹è¯»å–æ•°æ®çš„æ—¶å€™è¦ä¹ˆå°±æ˜¯æ²¡è¯»ï¼Œè¦ä¹ˆå°±æ˜¯è¯»å®Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å£°æ˜çš„ä¸€ä¸ªbooleanç±»å‹çš„å˜é‡æ¥è¿›è¡Œæ§åˆ¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> notRead = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getProgress</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> notRead ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çŸ¥é“é€šè¿‡<strong><em>nextKeyValue()</em></strong>æ–¹æ³•æ¥è¯»å–ä¸‹ä¸€ç»„KVå€¼ï¼Œé€šè¿‡<strong><em>getCurrentKey()å’ŒgetCurrentValue()</em></strong>æ¥è·å–æ•°æ®çš„Keyå’ŒValueï¼Œå¯ä»¥çœ‹åˆ°keyå’Œvalueå€¼å¾—è·å–è·¨äº†æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å£°æ˜æˆå‘˜å˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Text key = <span class="keyword">new</span> Text();</span><br><span class="line"><span class="keyword">private</span> BytesWritable value = <span class="keyword">new</span> BytesWritable();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Text <span class="title">getCurrentKey</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> BytesWritable <span class="title">getCurrentValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæˆ‘ä»¬æœ€ç»ˆè¦åªå¤„ç†ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”æˆ‘ä»¬åªè¯»ä¸€æ¬¡å°±æŠŠæ–‡ä»¶éƒ½è¯»å®Œäº†ï¼Œäºæ˜¯<strong><em>nextKeyValue()æ–¹æ³•</em></strong>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ä¼šè¿”å›tureè¡¨ç¤ºèƒ½è¯»åˆ°æ•°æ®ï¼Œç¬¬äºŒæ¬¡å°±ä¼šè¿”å›falseã€‚ç®€å•æ¶å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">nextKeyValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (notRead) &#123;</span><br><span class="line">        <span class="comment">// å…·ä½“è¯»æ–‡ä»¶çš„è¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line">        notRead = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å…·ä½“å®ç°éœ€æ±‚ï¼Œé¦–å…ˆè¯»å–æ–‡ä»¶éœ€è¦å¼€å¯æµï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<strong><em>initialize()</em></strong>æ–¹æ³•é‡Œå¼€å¯ï¼Œä¹Ÿå¯ä»¥åœ¨<strong><em>nextKeyValue()</em></strong>ä¸­å¼€å¯ï¼Œæˆ‘ä»¬ä»¥åœ¨<strong><em>initialize()</em></strong>æ–¹æ³•ä¸­å¼€å¯ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨<strong><em>initialize()</em></strong>æ–¹æ³•ä¸­å¼€å¯æµï¼Œåœ¨<strong><em>nextKeyValue()æ–¹æ³•</em></strong>ä¸­ä½¿ç”¨ï¼Œåœ¨<strong><em>close()</em></strong>æ–¹æ³•ä¸­å…³é—­æµï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªæˆå‘˜å˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸ºä»¥åçš„æ“ä½œéœ€è¦ç”¨åˆ°path è¿™é‡Œå°±ç›´æ¥æå‡ºæ¥äº†</span></span><br><span class="line"><span class="keyword">private</span> FileSplit fs;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(InputSplit split, TaskAttemptContext context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">       <span class="comment">// è½¬æ¢åˆ‡ç‰‡ç±»å‹åˆ°æ–‡ä»¶åˆ‡ç‰‡ã€å› ä¸ºsplitæœ¬èº«å°±æ˜¯FileSplit FileSplitç»§æ‰¿InputSplitã€</span></span><br><span class="line">       fs = (FileSplit) split;</span><br><span class="line">       <span class="comment">// ç»“åˆä¹‹å‰æ–‡ç« ï¼šHDFSçš„æ•°æ®æµå†™å…¥</span></span><br><span class="line">       <span class="comment">// é€šè¿‡åˆ‡ç‰‡è·å–è·¯å¾„</span></span><br><span class="line">       Path path = fs.getPath();</span><br><span class="line">       <span class="comment">// é€šè¿‡è·¯å¾„è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">       FileSystem fileSystem = path.getFileSystem(context.getConfiguration());</span><br><span class="line">       <span class="comment">// å¼€æµ</span></span><br><span class="line">       inputStream = fileSystem.open(path);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       IOUtils.closeStream(inputStream);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å®Œæˆè¯»çš„è¿‡ç¨‹ã€‚è¯´ç™½äº†å°±æ˜¯è¯»å‡ºKeyå’ŒValueã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">nextKeyValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (notRead) &#123;</span><br><span class="line">           <span class="comment">// å…·ä½“è¯»æ–‡ä»¶çš„è¿‡ç¨‹</span></span><br><span class="line">           <span class="comment">// è¯»Key</span></span><br><span class="line">           key.set(fs.getPath().toString());</span><br><span class="line"></span><br><span class="line">           <span class="comment">// è¯»Value</span></span><br><span class="line">           <span class="comment">// å› ä¸ºæˆ‘ä»¬çš„valueä¸ºBytesWritable æ‰€ä»¥æˆ‘ä»¬æ ¹æ®æ–‡ä»¶çš„å¤§å°å£°æ˜ä¸€ä¸ªbyteæ•°ç»„</span></span><br><span class="line">           <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) fs.getLength()];</span><br><span class="line">           <span class="comment">// å°†æµä¸­è¯»å–çš„å­—èŠ‚å­˜å‚¨åˆ°byteæ•°ç»„ä¸­</span></span><br><span class="line">           inputStream.read(buf);</span><br><span class="line">           value.set(buf, <span class="number">0</span>, buf.length);</span><br><span class="line"></span><br><span class="line">           notRead = <span class="keyword">false</span>;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢é“ºå‡ºå…¨éƒ¨WholeFileRecordReaderã€WholeFileInputFormatä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FSDataInputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.BytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileSplit;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.InputSplit;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.RecordReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.TaskAttemptContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰RRï¼Œå¤„ç†ä¸€ä¸ªæ–‡ä»¶ï¼šæŠŠè¿™ä¸ªæ–‡ä»¶ç›´æ¥éƒ½åŸä¸€ä¸ªKVå€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> : WholeFileRecordReader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : murasaki</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> : 2019-10-08 11:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> : 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WholeFileRecordReader</span> <span class="keyword">extends</span> <span class="title">RecordReader</span>&lt;<span class="title">Text</span>, <span class="title">BytesWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> notRead = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Text key = <span class="keyword">new</span> Text();</span><br><span class="line">    <span class="keyword">private</span> BytesWritable value = <span class="keyword">new</span> BytesWritable();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FSDataInputStream inputStream;</span><br><span class="line">    <span class="keyword">private</span> FileSplit fs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¡†æ¶ä¼šåœ¨å¼€å§‹çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> MurasakiSeiFu</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:06 2019-10-08</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> [split:åˆ‡ç‰‡, context:ä»»åŠ¡ä¿¡æ¯]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(InputSplit split, TaskAttemptContext context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// è½¬æ¢åˆ‡ç‰‡ç±»å‹åˆ°æ–‡ä»¶åˆ‡ç‰‡ã€å› ä¸ºsplitæœ¬èº«å°±æ˜¯FileSplit FileSplitç»§æ‰¿InputSplitã€</span></span><br><span class="line">        fs = (FileSplit) split;</span><br><span class="line">        <span class="comment">// ç»“åˆä¹‹å‰æ–‡ç« ï¼šHDFSçš„æ•°æ®æµå†™å…¥</span></span><br><span class="line">        <span class="comment">// é€šè¿‡åˆ‡ç‰‡è·å–è·¯å¾„</span></span><br><span class="line">        Path path = fs.getPath();</span><br><span class="line">        <span class="comment">// é€šè¿‡è·¯å¾„è·å–æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">        FileSystem fileSystem = path.getFileSystem(context.getConfiguration());</span><br><span class="line">        <span class="comment">// å¼€æµ</span></span><br><span class="line">        inputStream = fileSystem.open(path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–ä¸‹ä¸€ç»„KVå€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span> MurasakiSeiFu</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 11:09 2019-10-08</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Param</span> []</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœè¯»åˆ°äº†ï¼Œè¿”å›trueï¼›è¯»å®Œäº†ï¼Œè¿”å›false</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">nextKeyValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (notRead) &#123;</span><br><span class="line">            <span class="comment">// å…·ä½“è¯»æ–‡ä»¶çš„è¿‡ç¨‹</span></span><br><span class="line">            <span class="comment">// è¯»Key</span></span><br><span class="line">            key.set(fs.getPath().toString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¯»Value</span></span><br><span class="line">            <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) fs.getLength()];</span><br><span class="line">            inputStream.read(buf);</span><br><span class="line">            value.set(buf, <span class="number">0</span>, buf.length);</span><br><span class="line"></span><br><span class="line">            notRead = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰è¯»åˆ°çš„Key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çš„Key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Text <span class="title">getCurrentKey</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰è¯»åˆ°çš„Value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çš„Value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BytesWritable <span class="title">getCurrentValue</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰æ•°æ®è¯»å–è¿›åº¦ï¼ˆæˆ‘ä»¬æ‰§è¡ŒMRçš„æ—¶å€™ï¼Œä¼šçœ‹åˆ°Maperæ‰§è¡Œåˆ°ç™¾åˆ†ä¹‹å‡ ï¼Œå°±æ˜¯ä»è¿™é‡Œæ¥çš„ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰çš„è¿›åº¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getProgress</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> notRead ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­èµ„æº</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        IOUtils.closeStream(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.BytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.InputSplit;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.JobContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.RecordReader;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.TaskAttemptContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³›å‹: K ä¸º Textï¼ˆæ–‡ä»¶åï¼‰ V ä¸º BytesWritableï¼ˆä¸€æ®µ2è¿›åˆ¶æ•°å€¼ï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> : WholeFileInputFormat</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : murasaki</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> : 2019-10-08 10:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> : 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WholeFileInputFormat</span> <span class="keyword">extends</span> <span class="title">FileInputFormat</span>&lt;<span class="title">Text</span>, <span class="title">BytesWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isSplitable</span><span class="params">(JobContext context, Path filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RecordReader&lt;Text, BytesWritable&gt; <span class="title">createRecordReader</span><span class="params">(InputSplit split, TaskAttemptContext context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WholeFileRecordReader();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬å†™ä¸€ä¸‹Driverï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰é‡æ–°Mapperå’ŒReducerï¼Œå› ä¸ºä¸éœ€è¦ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„æ˜¯é»˜è®¤çš„Mapperã€Reducerã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.BytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WholeFileDriver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Job job = Job.getInstance(<span class="keyword">new</span> Configuration());</span><br><span class="line"></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(BytesWritable.class);</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(BytesWritable.class);</span><br><span class="line"></span><br><span class="line">        job.setInputFormatClass(WholeFileInputFormat.class);</span><br><span class="line">        job.setOutputFormatClass(SequenceFileOutputFormat.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬è‡ªå®šä¹‰çš„InputFormatç»§æ‰¿çš„æ˜¯FileInputFormat æ‰€ä»¥è¿™é‡Œç”¨FileInputFormat å¦‚æœç»§æ‰¿äº†å…¶ä»–çš„ è¿™é‡Œå°±æ¢åšç»§æ‰¿çš„</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(<span class="string">""</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">""</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬inputæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7qworfri6j31iu0dmgnc.jpg" alt=""></p>
<p>æ‰§è¡Œä¹‹åæˆ‘ä»¬çœ‹ä¸‹outputä¸­çš„ä¿¡æ¯ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7qwpjdr9zj31ee0hy0w2.jpg" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Keywä¸ºè·¯å¾„ï¼ŒValueä¸ºæ–‡ä»¶å†…å®¹ã€‚</p>

    
  </div>

</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">Chat with me ğŸ¾</span>
      <div class="donation-body">
        <div class="tip text-center">Tell me when you add that you are from the blog</div>
        <ul>
        
          <li class="item">
            
            <img src="/images/WechatIMG5.jpeg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2019/09/27/BD-MapReduce2-MapReduceåºåˆ—åŒ–/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2019/10/15/BD-MapReduce9-MapReduceæ¡†æ¶åŸç†ä¹‹MapReduceå¼€å‘æ€»ç»“/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              å‹é“¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              æœç´¢
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
    <div id="comment" class="vcomment" ></div>
    <script>
        var notify = 'false' == true ? true : false;
        var verify = 'false' == true ? true : false;
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
            return GUEST_INFO.indexOf(item) > -1
        });
        guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
        window.valine = new Valine({
            el: '.vcomment',
            notify: notify,
            verify: verify,
            appId: "9cprXYUH7H1YKlRERiGS8bxV-gzGzoHsz",
            appKey: "et0Drv2jnj4ILMBUSaNM2M2R",
            avatar:'mm',
            placeholder: "Talk to me ^_^",
            guest_info:guest_info,
            pageSize:'10'
        });
    </script>
  
    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
